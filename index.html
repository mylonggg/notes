<!DOCTYPE html>
<html>
<head>
    <title>å›¾ç‰‡ä¸Šä¼ æµ‹è¯•</title>
    <style>
        body { padding: 20px; font-family: Arial; }
        input, button { margin: 5px; padding: 10px; }
        #log { background: #eee; padding: 10px; margin-top: 20px; }
    </style>
</head>
<body>
    <h2>ç®€å•å›¾ç‰‡ä¸Šä¼ æµ‹è¯•</h2>
    
    <div>
        <input type="text" id="url" placeholder="Worker URL" style="width: 300px;">
    </div>
    <div>
        <input type="password" id="key" placeholder="Admin Key (123456)" style="width: 200px;">
    </div>
    
    <hr>
    
    <button onclick="test()">æµ‹è¯•è¿æ¥</button>
    <button onclick="init()">åˆå§‹åŒ–æ•°æ®åº“</button>
    <br>
    <input type="file" id="file" accept="image/*">
    <button onclick="upload()">ä¸Šä¼ å›¾ç‰‡</button>
    <button onclick="list()">æŸ¥çœ‹åˆ—è¡¨</button>
    
    <div id="log"></div>
    
    <script>
        function log(msg) {
            document.getElementById('log').innerHTML += msg + '<br>';
            console.log(msg);
        }
        
        function getUrl() {
            return document.getElementById('url').value || 'https://cloudnotes-simple.YOURNAME.workers.dev';
        }
        
        function getKey() {
            return document.getElementById('key').value || '123456';
        }
        
        async function test() {
            try {
                const res = await fetch(getUrl() + '/api/health');
                const data = await res.json();
                log('âœ… è¿æ¥æˆåŠŸ: ' + JSON.stringify(data));
            } catch(e) {
                log('âŒ è¿æ¥å¤±è´¥: ' + e.message);
            }
        }
        
        async function init() {
            try {
                const res = await fetch(getUrl() + '/api/init', {
                    method: 'POST'
                });
                const data = await res.json();
                if (data.success) {
                    log('âœ… æ•°æ®åº“åˆå§‹åŒ–æˆåŠŸ');
                } else {
                    log('âŒ åˆå§‹åŒ–å¤±è´¥: ' + data.error);
                }
            } catch(e) {
                log('âŒ é”™è¯¯: ' + e.message);
            }
        }
        
        async function upload() {
            const fileInput = document.getElementById('file');
            const file = fileInput.files[0];
            
            if (!file) {
                alert('è¯·é€‰æ‹©æ–‡ä»¶');
                return;
            }
            
            const formData = new FormData();
            formData.append('image', file);
            
            try {
                const res = await fetch(getUrl() + '/api/upload', {
                    method: 'POST',
                    headers: {
                        'Authorization': getKey()
                    },
                    body: formData
                });
                
                const data = await res.json();
                
                if (data.success) {
                    log('âœ… ä¸Šä¼ æˆåŠŸï¼ID: ' + data.id);
                    log('å›¾ç‰‡URL: ' + getUrl() + data.url);
                    
                    // æ˜¾ç¤ºå›¾ç‰‡
                    const img = document.createElement('img');
                    img.src = getUrl() + data.url;
                    img.style.maxWidth = '300px';
                    img.style.margin = '10px';
                    document.getElementById('log').appendChild(img);
                } else {
                    log('âŒ ä¸Šä¼ å¤±è´¥: ' + data.error);
                }
            } catch(e) {
                log('âŒ é”™è¯¯: ' + e.message);
            }
        }
        
        async function list() {
            try {
                const res = await fetch(getUrl() + '/api/list', {
                    headers: {
                        'Authorization': getKey()
                    }
                });
                
                const data = await res.json();
                
                if (data.success) {
                    log('ğŸ“‹ å›¾ç‰‡åˆ—è¡¨:');
                    data.images.forEach(img => {
                        log(`- ${img.id} (${img.size} bytes) - ${img.created_at}`);
                    });
                } else {
                    log('âŒ è·å–å¤±è´¥: ' + data.error);
                }
            } catch(e) {
                log('âŒ é”™è¯¯: ' + e.message);
            }
        }
        
        // è‡ªåŠ¨åŠ è½½
        document.addEventListener('DOMContentLoaded', () => {
            log('é¡µé¢åŠ è½½å®Œæˆ');
            log('è¯·å…ˆï¼š');
            log('1. éƒ¨ç½²Worker');
            log('2. è¾“å…¥URLå’ŒKeyï¼ˆé»˜è®¤123456ï¼‰');
            log('3. ç‚¹å‡»"åˆå§‹åŒ–æ•°æ®åº“"');
            log('4. é€‰æ‹©å›¾ç‰‡å¹¶ä¸Šä¼ ');
        });
    </script>
</body>
</html>
