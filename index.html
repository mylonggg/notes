<!DOCTYPE html>
<html lang="zh-CN">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>CloudNotes | éšç§åŠ å¯†ç¬”è®°ä¸å¯¼èˆª</title>
    <link rel="manifest" href="manifest.json">
    <link rel="apple-touch-icon" href="icon.png">
    <meta name="theme-color" content="#020617">
    <script src="https://cdn.tailwindcss.com"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/styles/github-dark.min.css">
    <script src="https://cdnjs.cloudflare.com/ajax/libs/highlight.js/11.8.0/highlight.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/marked/marked.min.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;600;800&display=swap');

        body {
            font-family: 'Inter', sans-serif;
            background-color: #020617;
            color: #f8fafc;
        }

        .glass {
            background: rgba(30, 41, 59, 0.7);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .gradient-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #2563eb 100%);
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
        }

        .gradient-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(37, 99, 235, 0.4);
        }

        .note-card {
            transition: all 0.3s ease;
        }

        .note-card:hover {
            border-color: rgba(59, 130, 246, 0.5);
            background: rgba(30, 41, 59, 0.9);
        }

        ::-webkit-scrollbar {
            width: 0px;
        }

        /* Markdowné¢„è§ˆæ ·å¼ */
        .markdown-preview {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.6;
            overflow-wrap: break-word;
        }

        .markdown-preview h1 {
            font-size: 2em;
            font-weight: 800;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
            padding-bottom: 0.3em;
            border-bottom: 1px solid rgba(255, 255, 255, 0.1);
        }

        .markdown-preview h2 {
            font-size: 1.5em;
            font-weight: 700;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }

        .markdown-preview h3 {
            font-size: 1.25em;
            font-weight: 600;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }

        .markdown-preview h4 {
            font-size: 1.1em;
            font-weight: 600;
            margin-top: 1.5em;
            margin-bottom: 0.5em;
        }

        .markdown-preview p {
            margin-bottom: 1em;
        }

        .markdown-preview ul, .markdown-preview ol {
            margin-left: 1.5em;
            margin-bottom: 1em;
        }

        .markdown-preview li {
            margin-bottom: 0.5em;
        }

        .markdown-preview code {
            background: rgba(0, 0, 0, 0.3);
            padding: 0.2em 0.4em;
            border-radius: 0.25em;
            font-family: 'Monaco', 'Menlo', 'Ubuntu Mono', monospace;
            font-size: 0.9em;
        }

        .markdown-preview pre {
            background: rgba(0, 0, 0, 0.4);
            padding: 1em;
            border-radius: 0.5em;
            overflow-x: auto;
            margin-bottom: 1.5em;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .markdown-preview blockquote {
            border-left: 4px solid #3b82f6;
            padding-left: 1em;
            margin-left: 0;
            margin-bottom: 1.5em;
            color: #94a3b8;
            font-style: italic;
        }

        .markdown-preview table {
            border-collapse: collapse;
            width: 100%;
            margin-bottom: 1.5em;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }

        .markdown-preview th, .markdown-preview td {
            border: 1px solid rgba(255, 255, 255, 0.1);
            padding: 0.75em;
            text-align: left;
        }

        .markdown-preview th {
            background: rgba(0, 0, 0, 0.2);
            font-weight: 600;
        }

        .markdown-preview a {
            color: #60a5fa;
            text-decoration: none;
        }

        .markdown-preview a:hover {
            text-decoration: underline;
        }

        .markdown-preview img {
            max-width: 100%;
            border-radius: 0.5em;
            margin-bottom: 1em;
        }

        .markdown-preview hr {
            border: none;
            height: 1px;
            background: rgba(255, 255, 255, 0.1);
            margin: 2em 0;
        }

        .tab-button {
            padding: 0.75em 1.5em;
            background: transparent;
            border: none;
            color: #94a3b8;
            cursor: pointer;
            transition: all 0.3s ease;
            font-weight: 600;
            border-radius: 0.5em;
        }

        .tab-button:hover {
            background: rgba(255, 255, 255, 0.05);
        }

        .tab-button.active {
            color: #60a5fa;
            background: rgba(59, 130, 246, 0.1);
        }

        .hljs {
            background: transparent !important;
        }
        
        .login-shake {
            animation: shake 0.5s ease-in-out;
        }
        
        @keyframes shake {
            0%, 100% { transform: translateX(0); }
            10%, 30%, 50%, 70%, 90% { transform: translateX(-5px); }
            20%, 40%, 60%, 80% { transform: translateX(5px); }
        }
        
        .login-bg {
            background: linear-gradient(135deg, #0f172a 0%, #1e293b 50%, #0f172a 100%);
        }
        
        .loader {
            width: 48px;
            height: 48px;
            border: 5px solid #3b82f6;
            border-bottom-color: transparent;
            border-radius: 50%;
            display: inline-block;
            box-sizing: border-box;
            animation: rotation 1s linear infinite;
        }

        @keyframes rotation {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        .share-gradient {
            background: linear-gradient(135deg, #f97316 0%, #dc2626 100%);
        }
        
        .share-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(220, 38, 38, 0.4);
        }
        
        .nav-gradient {
            background: linear-gradient(135deg, #8b5cf6 0%, #7c3aed 100%);
        }
        
        .nav-gradient:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(124, 58, 237, 0.4);
        }
        
        .nav-link-card {
            transition: all 0.3s cubic-bezier(0.4, 0, 0.2, 1);
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .nav-link-card:hover {
            transform: translateY(-4px);
            border-color: rgba(139, 92, 246, 0.5);
            box-shadow: 0 10px 25px -5px rgba(139, 92, 246, 0.3);
            background: rgba(30, 41, 59, 0.9);
        }
        
        .category-tag {
            display: inline-block;
            padding: 0.25em 0.75em;
            border-radius: 9999px;
            font-size: 0.75rem;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.05em;
        }
        
        .icon-blue { color: #60a5fa; }
        .icon-green { color: #34d399; }
        .icon-purple { color: #a78bfa; }
        .icon-red { color: #f87171; }
        .icon-yellow { color: #fbbf24; }
        .icon-pink { color: #f472b6; }
        .icon-indigo { color: #818cf8; }
        
        .quick-access-bar {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 100;
            display: flex;
            flex-direction: column;
            gap: 10px;
        }
        
        .quick-access-btn {
            width: 50px;
            height: 50px;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.25rem;
            transition: all 0.3s ease;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
        }
        
        .quick-access-btn:hover {
            transform: scale(1.1) rotate(5deg);
        }
        
        .modal-enter {
            animation: modalEnter 0.3s ease-out;
        }
        
        @keyframes modalEnter {
            from {
                opacity: 0;
                transform: scale(0.9) translateY(-20px);
            }
            to {
                opacity: 1;
                transform: scale(1) translateY(0);
            }
        }
        
        .nav-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(280px, 1fr));
            gap: 1.5rem;
        }
        
        /* å›¾ç‰‡ä¸Šä¼ ç›¸å…³æ ·å¼ */
        .image-upload-area {
            border: 2px dashed rgba(59, 130, 246, 0.3);
            border-radius: 1rem;
            padding: 3rem;
            text-align: center;
            transition: all 0.3s ease;
            cursor: pointer;
            background: rgba(30, 41, 59, 0.3);
        }
        
        .image-upload-area:hover {
            border-color: rgba(59, 130, 246, 0.6);
            background: rgba(30, 41, 59, 0.5);
        }
        
        .image-upload-area.dragover {
            border-color: rgba(34, 197, 94, 0.6);
            background: rgba(34, 197, 94, 0.1);
            transform: scale(1.02);
        }
        
        .image-upload-area.error {
            border-color: rgba(239, 68, 68, 0.6);
            background: rgba(239, 68, 68, 0.1);
        }
        
        .image-upload-area.success {
            border-color: rgba(34, 197, 94, 0.6);
            background: rgba(34, 197, 94, 0.1);
        }
        
        .image-preview-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(200px, 1fr));
            gap: 1rem;
            margin-top: 1rem;
        }
        
        .image-preview-item {
            position: relative;
            border-radius: 0.75rem;
            overflow: hidden;
            transition: all 0.3s ease;
        }
        
        .image-preview-item:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.3);
        }
        
        .image-preview-item img {
            width: 100%;
            height: 150px;
            object-fit: cover;
        }
        
        .image-preview-overlay {
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0, 0, 0, 0.7);
            display: flex;
            align-items: center;
            justify-content: center;
            opacity: 0;
            transition: opacity 0.3s ease;
        }
        
        .image-preview-item:hover .image-preview-overlay {
            opacity: 1;
        }
        
        .image-preview-actions {
            display: flex;
            gap: 0.5rem;
        }
        
        .image-preview-btn {
            width: 36px;
            height: 36px;
            border-radius: 50%;
            background: rgba(255, 255, 255, 0.9);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.2s ease;
        }
        
        .image-preview-btn:hover {
            background: white;
            transform: scale(1.1);
        }
        
        .image-preview-btn.copy {
            color: #3b82f6;
        }
        
        .image-preview-btn.delete {
            color: #ef4444;
        }
        
        .image-info {
            padding: 0.5rem;
            font-size: 0.75rem;
            color: #94a3b8;
            word-break: break-all;
        }
        
        .image-progress-bar {
            width: 100%;
            height: 4px;
            background: rgba(255, 255, 255, 0.1);
            border-radius: 2px;
            overflow: hidden;
            margin-top: 0.5rem;
        }
        
        .image-progress-fill {
            height: 100%;
            background: linear-gradient(90deg, #3b82f6, #8b5cf6);
            transition: width 0.3s ease;
        }
        
        /* å›¾ç‰‡ç®¡ç†å™¨æ ·å¼ */
        .image-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(220px, 1fr));
            gap: 1.25rem;
        }
        
        .image-manager-card {
            background: rgba(30, 41, 59, 0.5);
            border-radius: 1rem;
            overflow: hidden;
            transition: all 0.3s ease;
            border: 1px solid rgba(255, 255, 255, 0.05);
        }
        
        .image-manager-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 10px 25px -5px rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.3);
        }
        
        .image-manager-thumbnail {
            width: 100%;
            height: 160px;
            object-fit: cover;
            background: rgba(0, 0, 0, 0.2);
        }
        
        .image-manager-info {
            padding: 1rem;
        }
        
        .image-manager-meta {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 0.5rem;
            font-size: 0.75rem;
            color: #94a3b8;
        }
        
        .image-size {
            font-family: monospace;
        }
        
        /* å›¾ç‰‡ä¸Šä¼ æŒ‰é’®æ ·å¼ */
        .image-upload-btn {
            background: linear-gradient(135deg, #3b82f6 0%, #8b5cf6 100%);
            color: white;
            border: none;
            padding: 0.75rem 1.5rem;
            border-radius: 0.75rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s ease;
            display: flex;
            align-items: center;
            gap: 0.5rem;
        }
        
        .image-upload-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 20px -5px rgba(59, 130, 246, 0.4);
        }
        
        @media (max-width: 768px) {
            .nav-grid {
                grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
                gap: 1rem;
            }
            
            .quick-access-bar {
                bottom: 15px;
                right: 15px;
            }
            
            .quick-access-btn {
                width: 45px;
                height: 45px;
                font-size: 1.1rem;
            }
            
            .image-grid {
                grid-template-columns: repeat(auto-fill, minmax(180px, 1fr));
                gap: 1rem;
            }
            
            .image-upload-area {
                padding: 2rem;
            }
        }

        /* é¡¶éƒ¨æ§åˆ¶æ æŒ‰é’®æ ·å¼ */
        .toggle-btn {
            transition: all 0.3s ease;
            border: 1px solid rgba(59, 130, 246, 0.2);
        }
        
        .toggle-btn:hover {
            border-color: rgba(59, 130, 246, 0.4);
            background: rgba(59, 130, 246, 0.1);
        }
        
        .toggle-btn i {
            transition: transform 0.3s ease;
        }
        
        .toggle-btn.expanded i {
            transform: rotate(180deg);
        }
        
        /* å­—ç¬¦é¡ºåºæ¶ˆå¤±åŠ¨ç”»ç›¸å…³æ ·å¼ */
        .burning-text {
            position: relative;
            transition: all 0.3s ease;
        }
        
        .burning-char {
            display: inline-block;
            transition: all 0.6s cubic-bezier(0.4, 0, 0.2, 1);
            position: relative;
        }
        
        .char-burning {
            opacity: 0.1;
            transform: translateY(8px) scale(0.85);
            filter: blur(1.5px);
            color: #ff6b6b !important;
        }
        
        .char-removed {
            opacity: 0;
            visibility: hidden;
            transform: translateY(15px) scale(0.7);
        }
        
        .current-burning {
            position: relative;
            z-index: 10;
        }
        
        .current-burning::after {
            content: '';
            position: absolute;
            top: -2px;
            left: -2px;
            right: -2px;
            bottom: -2px;
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            border-radius: 2px;
            z-index: -1;
            animation: glow 0.8s ease-in-out infinite alternate;
            opacity: 0.5;
        }
        
        @keyframes glow {
            from {
                opacity: 0.3;
                box-shadow: 0 0 5px #ff6b6b;
            }
            to {
                opacity: 0.6;
                box-shadow: 0 0 10px #ffa500, 0 0 20px #ff6b6b;
            }
        }
        
        .fire-trail {
            position: absolute;
            width: 3px;
            height: 3px;
            background: linear-gradient(45deg, #ff6b6b, #ffa500);
            border-radius: 50%;
            pointer-events: none;
            z-index: 100;
            box-shadow: 0 0 6px #ff6b6b;
            animation: fireTrail 0.8s ease-out forwards;
        }
        
        @keyframes fireTrail {
            0% {
                transform: translate(0, 0) scale(1);
                opacity: 1;
            }
            100% {
                transform: translate(var(--tx, 0), var(--ty, -20px)) scale(0.3);
                opacity: 0;
            }
        }
        
        .burn-progress-bar {
            height: 4px;
            background: linear-gradient(90deg, #dc2626, #f97316);
            border-radius: 2px;
            transition: width 0.3s ease;
            margin-top: 4px;
        }
        
        .burn-notification {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            background: rgba(220, 38, 38, 0.9);
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 107, 107, 0.3);
            padding: 12px 20px;
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(220, 38, 38, 0.3);
            animation: notificationSlide 0.5s ease-out;
            display: flex;
            align-items: center;
            gap: 10px;
        }
        
        @keyframes notificationSlide {
            from {
                transform: translateX(100%);
                opacity: 0;
            }
            to {
                transform: translateX(0);
                opacity: 1;
            }
        }
        
        .burn-cursor {
            position: absolute;
            width: 2px;
            height: 1.2em;
            background: #ff6b6b;
            animation: cursorBlink 1s infinite;
            pointer-events: none;
            z-index: 50;
        }
        
        @keyframes cursorBlink {
            0%, 50% { opacity: 1; }
            51%, 100% { opacity: 0; }
        }
        
        .typewriter-effect {
            overflow: hidden;
            white-space: nowrap;
            margin: 0 auto;
            letter-spacing: 0.15em;
        }
        
        /* Toast é€šçŸ¥æ ·å¼ */
        .toast {
            position: fixed;
            top: 20px;
            right: 20px;
            z-index: 1000;
            padding: 12px 20px;
            border-radius: 8px;
            color: white;
            font-weight: 600;
            display: flex;
            align-items: center;
            gap: 10px;
            box-shadow: 0 4px 12px rgba(0, 0, 0, 0.3);
            transform: translateY(-20px);
            opacity: 0;
            transition: all 0.3s ease;
        }
        
        .toast.show {
            transform: translateY(0);
            opacity: 1;
        }
        
        .toast.success {
            background: linear-gradient(135deg, #10b981, #059669);
        }
        
        .toast.error {
            background: linear-gradient(135deg, #ef4444, #dc2626);
        }
        
        .toast.info {
            background: linear-gradient(135deg, #3b82f6, #2563eb);
        }
        
        .share-btn {
            transition: all 0.3s ease;
        }
        
        .share-btn:hover {
            transform: translateY(-2px);
        }
        
        /* Markdownå·¥å…·æ æ ·å¼ */
        .markdown-toolbar {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
            padding: 0.75rem;
            background: rgba(15, 23, 42, 0.5);
            border-radius: 0.75rem;
            margin-bottom: 1rem;
        }
        
        .markdown-toolbar button {
            padding: 0.5rem 0.75rem;
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            color: #cbd5e1;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.875rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .markdown-toolbar button:hover {
            background: rgba(59, 130, 246, 0.2);
            border-color: rgba(59, 130, 246, 0.3);
            color: #60a5fa;
        }
        
        .markdown-toolbar button i {
            font-size: 0.75rem;
        }
        
        /* æ–°å¢ï¼šå›¾ç‰‡å·¥å…·æ æ ·å¼ */
        .image-toolbar {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            margin-top: 0.5rem;
        }
        
        .image-toolbar button {
            padding: 0.4rem 0.8rem;
            background: rgba(30, 41, 59, 0.7);
            border: 1px solid rgba(255, 255, 255, 0.1);
            border-radius: 0.5rem;
            color: #cbd5e1;
            cursor: pointer;
            transition: all 0.2s ease;
            font-size: 0.75rem;
            display: flex;
            align-items: center;
            gap: 0.25rem;
        }
        
        .image-toolbar button:hover {
            background: rgba(139, 92, 246, 0.2);
            border-color: rgba(139, 92, 246, 0.3);
            color: #a78bfa;
        }
    </style>
</head>

<body class="min-h-screen selection:bg-blue-500/30">
    <!-- Toast é€šçŸ¥å®¹å™¨ -->
    <div id="toastContainer"></div>
    
    <!-- è®¤è¯æ¨¡æ€æ¡† -->
    <div id="authModal" class="fixed inset-0 z-50 flex items-center justify-center p-4 login-bg hidden">
        <div class="glass w-full max-w-md p-10 rounded-[2.5rem] shadow-2xl space-y-8">
            <div class="text-center space-y-4">
                <div class="inline-flex p-4 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full text-5xl">ğŸ”</div>
                <div class="space-y-2">
                    <h1 class="text-3xl font-extrabold tracking-tight italic">CloudNotes</h1>
                    <p class="text-slate-400 leading-relaxed text-sm">ç§æœ‰åŠ å¯†ç¬”è®°ä¸å¯¼èˆªç³»ç»Ÿ<br>è¯·è¾“å…¥è®¿é—®å¯†ç ä»¥ç»§ç»­</p>
                </div>
            </div>
            
            <div class="space-y-6">
                <div class="space-y-3">
                    <label class="text-xs uppercase tracking-widest text-slate-400 font-bold ml-1">
                        è®¿é—®å¯†ç 
                        <span id="attemptsCount" class="text-rose-500 text-xs ml-2">å‰©ä½™å°è¯•æ¬¡æ•°: 5</span>
                    </label>
                    <input id="authPassword" type="password" 
                           class="w-full bg-slate-900/70 border border-slate-700 p-5 rounded-2xl outline-none focus:ring-2 ring-blue-500/50 text-center font-mono text-lg"
                           placeholder="è¯·è¾“å…¥å¯†ç "
                           autocomplete="off"
                           onkeydown="if(event.key === 'Enter') checkPassword()">
                    <p class="text-xs text-slate-500 text-center">
                        æç¤ºï¼šè¯·è”ç³»ç®¡ç†å‘˜è·å–è®¿é—®å¯†ç 
                    </p>
                </div>
                
                <button onclick="checkPassword()" id="verifyBtn"
                        class="w-full gradient-btn text-white py-5 rounded-2xl font-black tracking-widest uppercase text-sm shadow-xl hover:shadow-2xl transition-all">
                    éªŒè¯èº«ä»½
                </button>
                
                <div id="loadingSpinner" class="hidden text-center py-4">
                    <div class="loader mx-auto"></div>
                    <p class="text-slate-400 mt-4 text-sm">éªŒè¯ä¸­...</p>
                </div>
                
                <div class="pt-6 border-t border-white/5 text-center">
                    <p class="text-xs text-slate-500">
                        ğŸ”’ å®‰å…¨æç¤ºï¼šè¯·å‹¿åœ¨å…¬å…±è®¾å¤‡ä¸Šä¿å­˜å¯†ç 
                    </p>
                </div>
            </div>
        </div>
    </div>

    <!-- ä¸»åº”ç”¨å®¹å™¨ -->
    <div id="appContainer" class="hidden">
        <div id="app" class="max-w-6xl mx-auto px-4 py-8 md:py-12">
        </div>
    </div>

    <!-- å¿«é€Ÿè®¿é—®æ  -->
    <div id="quickAccessBar" class="quick-access-bar hidden">
        <button onclick="showAddNavLinkModal()" class="quick-access-btn nav-gradient text-white" title="æ·»åŠ å¯¼èˆªé“¾æ¥">
            <i class="fas fa-plus"></i>
        </button>
        <button onclick="showAddNoteModal()" class="quick-access-btn gradient-btn text-white" title="æ·»åŠ ç¬”è®°">
            <i class="fas fa-edit"></i>
        </button>
        <button onclick="scrollToTop()" class="quick-access-btn glass text-white" title="è¿”å›é¡¶éƒ¨">
            <i class="fas fa-arrow-up"></i>
        </button>
    </div>

    <!-- ç³»ç»Ÿé…ç½®æ¨¡æ€æ¡† -->
    <div id="settingsModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 flex items-center justify-center hidden p-4">
        <div class="glass w-full max-w-sm p-8 rounded-[2.5rem] shadow-2xl space-y-6 modal-enter">
            <h2 class="text-2xl font-extrabold tracking-tight">âš™ï¸ ç³»ç»Ÿé…ç½®</h2>
            <div class="space-y-4">
                <div class="space-y-1">
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1">Worker
                        æœåŠ¡åœ°å€</label>
                    <input id="setApi" type="text" placeholder="https://..."
                        class="w-full bg-slate-900/50 border border-slate-700 p-4 rounded-2xl outline-none focus:ring-2 ring-blue-500/50 text-sm transition-all">
                </div>
                <div class="space-y-1">
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1">ç®¡ç†å‘˜å¯†é’¥</label>
                    <input id="setKey" type="password" placeholder="â€¢â€¢â€¢â€¢â€¢â€¢â€¢â€¢"
                        class="w-full bg-slate-900/50 border border-slate-700 p-4 rounded-2xl outline-none focus:ring-2 ring-blue-500/50 text-sm transition-all">
                </div>
            </div>
            <div class="flex gap-3">
                <button onclick="closeSettings()"
                    class="flex-1 py-4 text-slate-400 font-semibold rounded-2xl hover:bg-slate-800 transition">å–æ¶ˆ</button>
                <button onclick="saveSettings()"
                    class="flex-1 py-4 gradient-btn text-white font-bold rounded-2xl">ä¿å­˜</button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘ç¬”è®°æ¨¡æ€æ¡† -->
    <div id="editModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 flex items-center justify-center hidden p-4">
        <div class="glass w-full max-w-4xl p-8 rounded-[2.5rem] shadow-2xl space-y-6 max-h-[95vh] overflow-hidden flex flex-col modal-enter">
            <h2 class="text-2xl font-extrabold tracking-tight flex items-center gap-2">
                <span class="text-blue-400">âœï¸</span> ç¼–è¾‘ç¬”è®°
                <span id="editNoteId" class="text-sm text-slate-400 ml-2 font-mono"></span>
            </h2>
            
            <div class="flex gap-2 mb-4">
                <button onclick="switchTab('edit')" class="tab-button active" id="editTabBtn">ç¼–è¾‘æ¨¡å¼</button>
                <button onclick="switchTab('preview')" class="tab-button" id="previewTabBtn">é¢„è§ˆæ¨¡å¼</button>
            </div>
            
            <div class="space-y-4 flex-1 overflow-hidden flex flex-col min-h-0">
                <div id="editTab" class="flex-1 flex flex-col min-h-0">
                    <div class="markdown-toolbar">
                        <button onclick="insertMarkdown('# ', 'æ ‡é¢˜')" title="ä¸€çº§æ ‡é¢˜">
                            <i class="fas fa-heading"></i> H1
                        </button>
                        <button onclick="insertMarkdown('## ', 'äºŒçº§æ ‡é¢˜')" title="äºŒçº§æ ‡é¢˜">
                            <i class="fas fa-heading"></i> H2
                        </button>
                        <button onclick="insertMarkdown('### ', 'ä¸‰çº§æ ‡é¢˜')" title="ä¸‰çº§æ ‡é¢˜">
                            <i class="fas fa-heading"></i> H3
                        </button>
                        <button onclick="insertMarkdown('**', 'ç²—ä½“æ–‡æœ¬')" title="ç²—ä½“">
                            <i class="fas fa-bold"></i>
                        </button>
                        <button onclick="insertMarkdown('*', 'æ–œä½“æ–‡æœ¬')" title="æ–œä½“">
                            <i class="fas fa-italic"></i>
                        </button>
                        <button onclick="insertMarkdown('~~', 'åˆ é™¤çº¿æ–‡æœ¬')" title="åˆ é™¤çº¿">
                            <i class="fas fa-strikethrough"></i>
                        </button>
                        <button onclick="insertMarkdown('- ', 'åˆ—è¡¨é¡¹')" title="æ— åºåˆ—è¡¨">
                            <i class="fas fa-list-ul"></i>
                        </button>
                        <button onclick="insertMarkdown('1. ', 'æœ‰åºåˆ—è¡¨')" title="æœ‰åºåˆ—è¡¨">
                            <i class="fas fa-list-ol"></i>
                        </button>
                        <button onclick="insertMarkdown('[é“¾æ¥æ–‡æœ¬](https://)', '')" title="é“¾æ¥">
                            <i class="fas fa-link"></i>
                        </button>
                        <button onclick="insertMarkdown('![æ›¿ä»£æ–‡æœ¬](https://)', '')" title="å›¾ç‰‡">
                            <i class="fas fa-image"></i>
                        </button>
                        <button onclick="insertMarkdown('> ', 'å¼•ç”¨æ–‡æœ¬')" title="å¼•ç”¨">
                            <i class="fas fa-quote-right"></i>
                        </button>
                        <button onclick="insertMarkdown('```javascript\n\n```', 'ä»£ç ')" title="ä»£ç å—">
                            <i class="fas fa-code"></i>
                        </button>
                        <button onclick="insertMarkdown('---\n', '')" title="åˆ†å‰²çº¿">
                            <i class="fas fa-minus"></i>
                        </button>
                        <button onclick="insertMarkdown('| è¡¨å¤´ | è¡¨å¤´ |\n|------|------|\n| å†…å®¹ | å†…å®¹ |', '')" title="è¡¨æ ¼">
                            <i class="fas fa-table"></i>
                        </button>
                        <button onclick="insertMarkdown('- [ ] ', 'ä»»åŠ¡é¡¹')" title="ä»»åŠ¡åˆ—è¡¨">
                            <i class="fas fa-tasks"></i>
                        </button>
                        <!-- æ–°å¢å›¾ç‰‡ä¸Šä¼ æŒ‰é’® -->
                        <button onclick="showImageUploadInEditor()" title="ä¸Šä¼ å›¾ç‰‡">
                            <i class="fas fa-cloud-upload-alt"></i> ä¸Šä¼ å›¾ç‰‡
                        </button>
                    </div>
                    
                    <div class="flex-1 min-h-0 border border-slate-800 rounded-2xl overflow-hidden bg-slate-950/50 relative">
                        <textarea id="editNoteContent" 
                            class="w-full h-full bg-transparent p-5 outline-none text-sm transition-all resize-none leading-relaxed font-mono min-h-[45vh] border-0"
                            placeholder="# æ ‡é¢˜&#10;&#10;## äºŒçº§æ ‡é¢˜&#10;&#10;- åˆ—è¡¨é¡¹&#10;- å¦ä¸€ä¸ªåˆ—è¡¨é¡¹&#10;&#10;**ç²—ä½“** *æ–œä½“* &#10;&#10;```javascript&#10;// ä»£ç å—&#10;console.log('Hello');&#10;```&#10;&#10;> å¼•ç”¨å†…å®¹&#10;&#10;| è¡¨å¤´1 | è¡¨å¤´2 |&#10;|--------|--------|&#10;| å•å…ƒæ ¼1 | å•å…ƒæ ¼2 |"></textarea>
                        
                        <div class="absolute bottom-3 right-4">
                            <div class="text-xs text-slate-500 bg-slate-900/70 px-2 py-1 rounded">
                                <span id="editCharCount">0</span> å­—ç¬¦
                            </div>
                        </div>
                    </div>
                </div>
                
                <div id="previewTab" class="flex-1 overflow-y-auto hidden min-h-0">
                    <div class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        Markdown é¢„è§ˆ
                    </div>
                    <div id="markdownPreview" class="markdown-preview p-5 bg-slate-950/50 border border-slate-800 rounded-2xl flex-1 overflow-y-auto min-h-[60vh]">
                        <!-- é¢„è§ˆå†…å®¹å°†é€šè¿‡JSåŠ¨æ€å¡«å…… -->
                    </div>
                </div>
            </div>
            
            <div class="flex gap-3 pt-6 border-t border-white/5">
                <button onclick="closeEdit()"
                    class="flex-1 py-4 text-slate-400 font-semibold rounded-2xl hover:bg-slate-800 transition">
                    å–æ¶ˆ
                </button>
                <button onclick="saveEdit()"
                    class="flex-1 py-4 gradient-btn text-white font-bold rounded-2xl">
                    ä¿å­˜æ›´æ”¹
                </button>
            </div>
            
            <div class="pt-4 border-t border-white/5 text-xs text-slate-500">
                <p class="flex items-center gap-2">
                    <span class="text-yellow-400">âš ï¸</span>
                    æ³¨æ„ï¼šç¼–è¾‘åç¬”è®°å°†ä½¿ç”¨å½“å‰ä¸»å¯†ç é‡æ–°åŠ å¯†ä¿å­˜åˆ°äº‘ç«¯
                </p>
            </div>
        </div>
    </div>

    <!-- å¿«é€Ÿæ·»åŠ ç¬”è®°æ¨¡æ€æ¡† -->
    <div id="addNoteModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 flex items-center justify-center hidden p-4">
        <div class="glass w-full max-w-2xl p-8 rounded-[2.5rem] shadow-2xl space-y-6 modal-enter">
            <h2 class="text-2xl font-extrabold tracking-tight flex items-center gap-2">
                <span class="text-blue-400">ğŸ“</span> å¿«é€Ÿæ·»åŠ ç¬”è®°
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        è§£å¯†ä¸»å¯†ç 
                    </label>
                    <input id="quickMainPw" type="password" placeholder="è¾“å…¥ä¸»å¯†ç ä»¥åŠ å¯†" 
                        class="w-full bg-slate-950/50 border border-slate-800 p-4 rounded-2xl outline-none focus:ring-2 ring-blue-500/50 transition-all font-mono">
                </div>
                
                <div>
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        ç¬”è®°å†…å®¹
                    </label>
                    <textarea id="quickNoteInput" placeholder="è¾“å…¥ç¬”è®°å†…å®¹..." 
                        class="w-full bg-slate-950/50 border border-slate-800 p-4 h-40 rounded-2xl outline-none focus:bg-slate-950 transition-all resize-none leading-relaxed"></textarea>
                    <div class="flex items-center gap-2 text-xs text-slate-500 mt-2">
                        <span id="quickNoteCharCount">0</span> å­—ç¬¦
                    </div>
                </div>
            </div>
            
            <div class="flex gap-3">
                <button onclick="closeAddNoteModal()"
                    class="flex-1 py-4 text-slate-400 font-semibold rounded-2xl hover:bg-slate-800 transition">
                    å–æ¶ˆ
                </button>
                <button onclick="quickSaveNote()"
                    class="flex-1 py-4 gradient-btn text-white font-bold rounded-2xl">
                    ä¿å­˜ç¬”è®°
                </button>
            </div>
        </div>
    </div>

    <!-- æ·»åŠ å¯¼èˆªé“¾æ¥æ¨¡æ€æ¡† -->
    <div id="addNavLinkModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 flex items-center justify-center hidden p-4">
        <div class="glass w-full max-w-md p-8 rounded-[2.5rem] shadow-2xl space-y-6 modal-enter">
            <h2 class="text-2xl font-extrabold tracking-tight flex items-center gap-2">
                <span class="text-purple-400">ğŸ”—</span> æ·»åŠ å¯¼èˆªé“¾æ¥
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        é“¾æ¥æ ‡é¢˜
                    </label>
                    <input id="navLinkTitle" type="text" placeholder="ä¾‹å¦‚ï¼šGitHub" 
                        class="w-full bg-slate-950/50 border border-slate-800 p-4 rounded-2xl outline-none focus:ring-2 ring-purple-500/50 transition-all">
                </div>
                
                <div>
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        é“¾æ¥åœ°å€
                    </label>
                    <input id="navLinkUrl" type="text" placeholder="https://..." 
                        class="w-full bg-slate-950/50 border border-slate-800 p-4 rounded-2xl outline-none focus:ring-2 ring-purple-500/50 transition-all font-mono text-sm">
                </div>
                
                <div>
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        åˆ†ç±»æ ‡ç­¾
                    </label>
                    <div class="flex flex-wrap gap-2 mb-2">
                        <button onclick="setNavCategory('å¼€å‘å·¥å…·')" class="px-3 py-1 bg-blue-900/30 text-blue-400 rounded-lg hover:bg-blue-800/50 transition text-xs">å¼€å‘å·¥å…·</button>
                        <button onclick="setNavCategory('æ—¥å¸¸æ•ˆç‡')" class="px-3 py-1 bg-green-900/30 text-green-400 rounded-lg hover:bg-green-800/50 transition text-xs">æ—¥å¸¸æ•ˆç‡</button>
                        <button onclick="setNavCategory('è®¾è®¡èµ„æº')" class="px-3 py-1 bg-purple-900/30 text-purple-400 rounded-lg hover:bg-purple-800/50 transition text-xs">è®¾è®¡èµ„æº</button>
                        <button onclick="setNavCategory('å­¦ä¹ èµ„æº')" class="px-3 py-1 bg-yellow-900/30 text-yellow-400 rounded-lg hover:bg-yellow-800/50 transition text-xs">å­¦ä¹ èµ„æº</button>
                        <button onclick="setNavCategory('ç¤¾äº¤å¨±ä¹')" class="px-3 py-1 bg-pink-900/30 text-pink-400 rounded-lg hover:bg-pink-800/50 transition text-xs">ç¤¾äº¤å¨±ä¹</button>
                    </div>
                    <input id="navLinkCategory" type="text" placeholder="è‡ªå®šä¹‰åˆ†ç±»æˆ–é€‰æ‹©ä¸Šæ–¹æ ‡ç­¾" 
                        class="w-full bg-slate-950/50 border border-slate-800 p-4 rounded-2xl outline-none focus:ring-2 ring-purple-500/50 transition-all">
                </div>
                
                <div>
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        å›¾æ ‡é€‰æ‹©
                    </label>
                    <div class="flex flex-wrap gap-3 mb-2">
                        <button onclick="setNavIcon('fas fa-globe', 'icon-blue')" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fas fa-globe icon-blue"></i></button>
                        <button onclick="setNavIcon('fas fa-code', 'icon-green')" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fas fa-code icon-green"></i></button>
                        <button onclick="setNavIcon('fas fa-tools', 'icon-yellow')" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fas fa-tools icon-yellow"></i></button>
                        <button onclick="setNavIcon('fas fa-palette', 'icon-purple')" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fas fa-palette icon-purple"></i></button>
                        <button onclick="setNavIcon('fas fa-book', 'icon-indigo')" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fas fa-book icon-indigo"></i></button>
                        <button onclick="setNavIcon('fas fa-film', 'icon-pink')" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fas fa-film icon-pink"></i></button>
                    </div>
                    <input id="navLinkIcon" type="hidden" value="fas fa-globe">
                    <input id="navLinkIconColor" type="hidden" value="icon-blue">
                </div>
                
                <div>
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        æè¿°ï¼ˆå¯é€‰ï¼‰
                    </label>
                    <textarea id="navLinkDescription" placeholder="é“¾æ¥çš„ç®€è¦æè¿°..." 
                        class="w-full bg-slate-950/50 border border-slate-800 p-4 h-24 rounded-2xl outline-none focus:bg-slate-950 transition-all resize-none"></textarea>
                </div>
            </div>
            
            <div class="flex gap-3">
                <button onclick="closeAddNavLinkModal()"
                    class="flex-1 py-4 text-slate-400 font-semibold rounded-2xl hover:bg-slate-800 transition">
                    å–æ¶ˆ
                </button>
                <button onclick="saveNavLink()"
                    class="flex-1 py-4 nav-gradient text-white font-bold rounded-2xl">
                    ä¿å­˜é“¾æ¥
                </button>
            </div>
        </div>
    </div>

    <!-- ç¼–è¾‘å¯¼èˆªé“¾æ¥æ¨¡æ€æ¡† -->
    <div id="editNavLinkModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 flex items-center justify-center hidden p-4">
        <div class="glass w-full max-w-md p-8 rounded-[2.5rem] shadow-2xl space-y-6 modal-enter">
            <h2 class="text-2xl font-extrabold tracking-tight flex items-center gap-2">
                <span class="text-purple-400">âœï¸</span> ç¼–è¾‘å¯¼èˆªé“¾æ¥
                <span id="editNavLinkId" class="text-sm text-slate-400 ml-2 font-mono"></span>
            </h2>
            
            <div class="space-y-4">
                <div>
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        é“¾æ¥æ ‡é¢˜
                    </label>
                    <input id="editNavLinkTitle" type="text" placeholder="ä¾‹å¦‚ï¼šGitHub" 
                        class="w-full bg-slate-950/50 border border-slate-800 p-4 rounded-2xl outline-none focus:ring-2 ring-purple-500/50 transition-all">
                </div>
                
                <div>
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        é“¾æ¥åœ°å€
                    </label>
                    <input id="editNavLinkUrl" type="text" placeholder="https://..." 
                        class="w-full bg-slate-950/50 border border-slate-800 p-4 rounded-2xl outline-none focus:ring-2 ring-purple-500/50 transition-all font-mono text-sm">
                </div>
                
                <div>
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        åˆ†ç±»æ ‡ç­¾
                    </label>
                    <div class="flex flex-wrap gap-2 mb-2">
                        <button onclick="setEditNavCategory('å¼€å‘å·¥å…·')" class="px-3 py-1 bg-blue-900/30 text-blue-400 rounded-lg hover:bg-blue-800/50 transition text-xs">å¼€å‘å·¥å…·</button>
                        <button onclick="setEditNavCategory('æ—¥å¸¸æ•ˆç‡')" class="px-3 py-1 bg-green-900/30 text-green-400 rounded-lg hover:bg-green-800/50 transition text-xs">æ—¥å¸¸æ•ˆç‡</button>
                        <button onclick="setEditNavCategory('è®¾è®¡èµ„æº')" class="px-3 py-1 bg-purple-900/30 text-purple-400 rounded-lg hover:bg-purple-800/50 transition text-xs">è®¾è®¡èµ„æº</button>
                        <button onclick="setEditNavCategory('å­¦ä¹ èµ„æº')" class="px-3 py-1 bg-yellow-900/30 text-yellow-400 rounded-lg hover:bg-yellow-800/50 transition text-xs">å­¦ä¹ èµ„æº</button>
                        <button onclick="setEditNavCategory('ç¤¾äº¤å¨±ä¹')" class="px-3 py-1 bg-pink-900/30 text-pink-400 rounded-lg hover:bg-pink-800/50 transition text-xs">ç¤¾äº¤å¨±ä¹</button>
                    </div>
                    <input id="editNavLinkCategory" type="text" placeholder="è‡ªå®šä¹‰åˆ†ç±»æˆ–é€‰æ‹©ä¸Šæ–¹æ ‡ç­¾" 
                        class="w-full bg-slate-950/50 border border-slate-800 p-4 rounded-2xl outline-none focus:ring-2 ring-purple-500/50 transition-all">
                </div>
                
                <div>
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        å›¾æ ‡é€‰æ‹©
                    </label>
                    <div class="flex flex-wrap gap-3 mb-2">
                        <button onclick="setEditNavIcon('fas fa-globe', 'icon-blue')" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fas fa-globe icon-blue"></i></button>
                        <button onclick="setEditNavIcon('fas fa-code', 'icon-green')" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fas fa-code icon-green"></i></button>
                        <button onclick="setEditNavIcon('fas fa-tools', 'icon-yellow')" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fas fa-tools icon-yellow"></i></button>
                        <button onclick="setEditNavIcon('fas fa-palette', 'icon-purple')" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fas fa-palette icon-purple"></i></button>
                        <button onclick="setEditNavIcon('fas fa-book', 'icon-indigo')" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fas fa-book icon-indigo"></i></button>
                        <button onclick="setEditNavIcon('fas fa-film', 'icon-pink')" class="p-2 bg-slate-800 rounded-lg hover:bg-slate-700 transition"><i class="fas fa-film icon-pink"></i></button>
                    </div>
                    <div id="editNavIconPreview" class="text-center py-2">
                    </div>
                    <input id="editNavLinkIcon" type="hidden">
                    <input id="editNavLinkIconColor" type="hidden">
                </div>
                
                <div>
                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                        æè¿°ï¼ˆå¯é€‰ï¼‰
                    </label>
                    <textarea id="editNavLinkDescription" placeholder="é“¾æ¥çš„ç®€è¦æè¿°..." 
                        class="w-full bg-slate-950/50 border border-slate-800 p-4 h-24 rounded-2xl outline-none focus:bg-slate-950 transition-all resize-none"></textarea>
                </div>
            </div>
            
            <div class="flex gap-3">
                <button onclick="closeEditNavLinkModal()"
                    class="flex-1 py-4 text-slate-400 font-semibold rounded-2xl hover:bg-slate-800 transition">
                    å–æ¶ˆ
                </button>
                <button onclick="updateNavLink()"
                    class="flex-1 py-4 nav-gradient text-white font-bold rounded-2xl">
                    æ›´æ–°é“¾æ¥
                </button>
            </div>
            
            <div class="pt-4 border-t border-white/5">
                <button onclick="confirmDeleteNavLink()" class="w-full py-3 bg-rose-900/30 text-rose-400 rounded-2xl hover:bg-rose-800/50 transition font-semibold">
                    ğŸ—‘ï¸ åˆ é™¤æ­¤é“¾æ¥
                </button>
            </div>
        </div>
    </div>

    <!-- å›¾ç‰‡ä¸Šä¼ æ¨¡æ€æ¡† -->
    <div id="imageUploadModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 flex items-center justify-center hidden p-4">
        <div class="glass w-full max-w-2xl p-8 rounded-[2.5rem] shadow-2xl space-y-6 modal-enter">
            <h2 class="text-2xl font-extrabold tracking-tight flex items-center gap-2">
                <span class="text-emerald-400">ğŸ–¼ï¸</span> ä¸Šä¼ å›¾ç‰‡
            </h2>
            
            <div class="space-y-4">
                <div id="imageUploadArea" class="image-upload-area" 
                     ondragover="handleDragOver(event)" 
                     ondragleave="handleDragLeave(event)" 
                     ondrop="handleDrop(event)">
                    <div class="space-y-3">
                        <div class="text-4xl text-slate-400">
                            <i class="fas fa-cloud-upload-alt"></i>
                        </div>
                        <div class="space-y-1">
                            <h3 class="font-semibold text-slate-300">æ‹–æ”¾æ–‡ä»¶åˆ°æ­¤å¤„</h3>
                            <p class="text-sm text-slate-500">æ”¯æŒ JPGã€PNGã€GIF æ ¼å¼ï¼Œæœ€å¤§ 5MB</p>
                        </div>
                        <div>
                            <label for="imageFileInput" class="image-upload-btn cursor-pointer inline-block">
                                <i class="fas fa-folder-open"></i> é€‰æ‹©æ–‡ä»¶
                            </label>
                            <input type="file" id="imageFileInput" multiple accept="image/*" class="hidden" onchange="handleFileSelect(event)">
                        </div>
                    </div>
                </div>
                
                <div id="imagePreviews" class="image-preview-container hidden">
                    <!-- å›¾ç‰‡é¢„è§ˆå°†é€šè¿‡JSåŠ¨æ€ç”Ÿæˆ -->
                </div>
                
                <div id="uploadProgress" class="hidden">
                    <div class="flex justify-between text-xs text-slate-400 mb-1">
                        <span>ä¸Šä¼ è¿›åº¦</span>
                        <span id="uploadPercentage">0%</span>
                    </div>
                    <div class="image-progress-bar">
                        <div id="uploadProgressFill" class="image-progress-fill" style="width: 0%"></div>
                    </div>
                </div>
                
                <div id="uploadStatus" class="text-center text-sm">
                    <!-- ä¸Šä¼ çŠ¶æ€ä¿¡æ¯ -->
                </div>
            </div>
            
            <div class="flex gap-3 pt-4 border-t border-white/5">
                <button onclick="closeImageUploadModal()"
                    class="flex-1 py-4 text-slate-400 font-semibold rounded-2xl hover:bg-slate-800 transition">
                    å–æ¶ˆ
                </button>
                <button onclick="startImageUpload()" id="uploadBtn"
                    class="flex-1 py-4 bg-emerald-600 text-white font-bold rounded-2xl hover:bg-emerald-700 transition">
                    å¼€å§‹ä¸Šä¼ 
                </button>
            </div>
        </div>
    </div>

    <!-- å›¾ç‰‡ç®¡ç†å™¨æ¨¡æ€æ¡† -->
    <div id="imageManagerModal"
        class="fixed inset-0 bg-black/60 backdrop-blur-md z-50 flex items-center justify-center hidden p-4">
        <div class="glass w-full max-w-5xl p-8 rounded-[2.5rem] shadow-2xl space-y-6 modal-enter max-h-[95vh] overflow-hidden flex flex-col">
            <h2 class="text-2xl font-extrabold tracking-tight flex items-center justify-between">
                <div class="flex items-center gap-2">
                    <span class="text-emerald-400">ğŸ“·</span> å›¾ç‰‡ç®¡ç†å™¨
                </div>
                <div class="image-toolbar">
                    <button onclick="refreshImageList()" title="åˆ·æ–°">
                        <i class="fas fa-sync-alt"></i>
                    </button>
                    <button onclick="showImageUploadModal()" title="ä¸Šä¼ æ–°å›¾ç‰‡">
                        <i class="fas fa-plus"></i> ä¸Šä¼ 
                    </button>
                </div>
            </h2>
            
            <div class="flex-1 overflow-y-auto min-h-0">
                <div id="imageManagerContent">
                    <div class="text-center py-12 text-slate-600 italic text-sm">
                        åŠ è½½ä¸­...
                    </div>
                </div>
            </div>
            
            <div class="pt-4 border-t border-white/5">
                <button onclick="closeImageManagerModal()"
                    class="w-full py-4 text-slate-400 font-semibold rounded-2xl hover:bg-slate-800 transition">
                    å…³é—­
                </button>
            </div>
        </div>
    </div>

    <script>
        // ==================== ç³»ç»Ÿé…ç½® ====================
        const urlParams = new URLSearchParams(window.location.search);
        let apiFromUrl = urlParams.get('api');
        const cfgFromUrl = urlParams.get('cfg');
        if (cfgFromUrl) { try { apiFromUrl = atob(cfgFromUrl); } catch (e) { } }
        const shareId = urlParams.get('share');

        let API_URL = apiFromUrl || localStorage.getItem('cf_notes_api') || "";
        let ADMIN_KEY = localStorage.getItem('cf_notes_key') || "";

        let currentEditId = null;
        let currentEditNavLinkId = null;
        
        let notesCache = {};
        let navLinksCache = {};
        let currentView = 'notes';
        
        // å›¾ç‰‡ä¸Šä¼ ç›¸å…³å˜é‡
        let selectedImages = [];
        let isUploading = false;

        // ==================== é˜…åå³ç„šå˜é‡ ====================
        let burningInterval = null;
        let burnCountdownInterval = null;
        let burnTimeLeft = 10;
        let originalContent = '';
        let burningChars = [];
        let isBurningActive = false;
        let totalChars = 0;
        let currentCharIndex = 0;
        let burnCursor = null;

        const app = document.getElementById('app');

        // ==================== å®‰å…¨é…ç½® ====================
        const SESSION_KEY = 'cloudnotes_auth_token';
        const ATTEMPTS_KEY = 'cloudnotes_auth_attempts';
        const MAX_ATTEMPTS = 5;
        const LOCKOUT_TIME = 300000;
        const LOCKOUT_KEY = 'cloudnotes_lockout_until';

        // ==================== åŠ è§£å¯†é€»è¾‘ ====================
        async function getK(pw) {
            const enc = new TextEncoder();
            const hash = await crypto.subtle.digest('SHA-256', enc.encode(pw));
            return await crypto.subtle.importKey('raw', hash, { name: 'AES-GCM' }, false, ['encrypt', 'decrypt']);
        }
        
        async function encrypt(text, pw) {
            const enc = new TextEncoder(); 
            const iv = crypto.getRandomValues(new Uint8Array(12)); 
            const key = await getK(pw);
            const cipher = await crypto.subtle.encrypt({ name: 'AES-GCM', iv }, key, enc.encode(text));
            return btoa(JSON.stringify({ iv: Array.from(iv), data: Array.from(new Uint8Array(cipher)) }));
        }
        
        async function decrypt(json, pw) {
            try {
                const { iv, data } = JSON.parse(atob(json)); 
                const key = await getK(pw);
                const dec = await crypto.subtle.decrypt({ name: 'AES-GCM', iv: new Uint8Array(iv) }, key, new Uint8Array(data));
                return new TextDecoder().decode(dec);
            } catch (e) { return null; }
        }

        // Markdown é…ç½®
        marked.setOptions({
            breaks: true,
            gfm: true,
            pedantic: false,
            smartLists: true,
            smartypants: true,
            xhtml: false,
            highlight: function(code, lang) {
                if (lang && hljs.getLanguage(lang)) {
                    try {
                        return hljs.highlight(code, { language: lang }).value;
                    } catch (__) {}
                }
                return hljs.highlightAuto(code).value;
            }
        });

        // ==================== å®‰å…¨éªŒè¯å‡½æ•° ====================
        function checkLockout() {
            const lockoutUntil = localStorage.getItem(LOCKOUT_KEY);
            if (lockoutUntil && Date.now() < parseInt(lockoutUntil)) {
                const remainingMinutes = Math.ceil((parseInt(lockoutUntil) - Date.now()) / 60000);
                return {
                    locked: true,
                    remainingMinutes: remainingMinutes
                };
            }
            return { locked: false };
        }
        
        function setLockout() {
            const lockoutUntil = Date.now() + LOCKOUT_TIME;
            localStorage.setItem(LOCKOUT_KEY, lockoutUntil.toString());
            
            setTimeout(() => {
                localStorage.removeItem(LOCKOUT_KEY);
                localStorage.removeItem(ATTEMPTS_KEY);
                location.reload();
            }, LOCKOUT_TIME);
        }
        
        function getRemainingAttempts() {
            const attempts = localStorage.getItem(ATTEMPTS_KEY);
            return attempts ? MAX_ATTEMPTS - parseInt(attempts) : MAX_ATTEMPTS;
        }
        
        function incrementFailedAttempts() {
            let attempts = localStorage.getItem(ATTEMPTS_KEY);
            attempts = attempts ? parseInt(attempts) + 1 : 1;
            localStorage.setItem(ATTEMPTS_KEY, attempts.toString());
            
            if (attempts >= MAX_ATTEMPTS) {
                setLockout();
            }
            
            return attempts;
        }
        
        function resetFailedAttempts() {
            localStorage.removeItem(ATTEMPTS_KEY);
            localStorage.removeItem(LOCKOUT_KEY);
        }
        
        // ==================== ä¸»éªŒè¯å‡½æ•° ====================
        async function checkPassword() {
            const lockoutCheck = checkLockout();
            const input = document.getElementById('authPassword');
            const attemptsCount = document.getElementById('attemptsCount');
            const verifyBtn = document.getElementById('verifyBtn');
            const loadingSpinner = document.getElementById('loadingSpinner');
            
            if (lockoutCheck.locked) {
                attemptsCount.innerHTML = `è´¦æˆ·å·²é”å®šï¼Œ${lockoutCheck.remainingMinutes}åˆ†é’Ÿåé‡è¯•`;
                input.value = '';
                input.classList.add('login-shake');
                input.disabled = true;
                verifyBtn.disabled = true;
                setTimeout(() => input.classList.remove('login-shake'), 500);
                return;
            }
            
            const password = input.value.trim();
            const remainingAttempts = getRemainingAttempts() - 1;
            
            if (!password) {
                attemptsCount.innerHTML = 'å¯†ç ä¸èƒ½ä¸ºç©º';
                input.classList.add('login-shake');
                setTimeout(() => {
                    input.classList.remove('login-shake');
                    attemptsCount.innerHTML = `å‰©ä½™å°è¯•æ¬¡æ•°: ${remainingAttempts + 1}`;
                }, 500);
                return;
            }
            
            verifyBtn.classList.add('hidden');
            loadingSpinner.classList.remove('hidden');
            input.disabled = true;
            
            try {
                const response = await fetch(`${API_URL}/api/verify-password`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({ password: password })
                });
                
                const result = await response.json();
                
                if (result.success) {
                    const token = btoa(Date.now() + '-' + Math.random().toString(36).substr(2));
                    sessionStorage.setItem(SESSION_KEY, token);
                    
                    resetFailedAttempts();
                    
                    document.getElementById('authModal').classList.add('hidden');
                    document.getElementById('appContainer').classList.remove('hidden');
                    
                    initApp();
                } else {
                    const attempts = incrementFailedAttempts();
                    const newRemaining = MAX_ATTEMPTS - attempts;
                    
                    if (attempts >= MAX_ATTEMPTS) {
                        attemptsCount.innerHTML = 'è´¦æˆ·å·²é”å®šï¼Œ5åˆ†é’Ÿåé‡è¯•';
                        setLockout();
                    } else {
                        attemptsCount.innerHTML = `å¯†ç é”™è¯¯ï¼Œå‰©ä½™å°è¯•æ¬¡æ•°: ${newRemaining}`;
                    }
                    
                    input.value = '';
                    input.classList.add('login-shake');
                    setTimeout(() => input.classList.remove('login-shake'), 500);
                }
            } catch (error) {
                console.error("éªŒè¯å¤±è´¥:", error);
                attemptsCount.innerHTML = 'ç½‘ç»œé”™è¯¯ï¼Œè¯·æ£€æŸ¥é…ç½®';
                input.value = '';
                input.classList.add('login-shake');
                setTimeout(() => {
                    input.classList.remove('login-shake');
                    attemptsCount.innerHTML = `å‰©ä½™å°è¯•æ¬¡æ•°: ${remainingAttempts + 1}`;
                }, 500);
            } finally {
                verifyBtn.classList.remove('hidden');
                loadingSpinner.classList.add('hidden');
                input.disabled = false;
                input.focus();
            }
        }
        
        // ç™»å‡º
        function logout() {
            sessionStorage.removeItem(SESSION_KEY);
            localStorage.removeItem(ATTEMPTS_KEY);
            localStorage.removeItem(LOCKOUT_KEY);
            location.reload();
        }
        
        // ==================== åº”ç”¨åˆå§‹åŒ–é€»è¾‘ ====================
        function initApp() {
            if (shareId) {
                renderShareView();
            } else if (!API_URL) {
                renderWelcomeView();
            } else {
                renderMainView();
            }
        }
        
        // æ£€æŸ¥ä¼šè¯
        function checkSession() {
            const token = sessionStorage.getItem(SESSION_KEY);
            const apiUrl = localStorage.getItem('cf_notes_api');
            
            if (shareId) {
                document.getElementById('authModal').classList.add('hidden');
                document.getElementById('appContainer').classList.remove('hidden');
                initApp();
                return true;
            }
            
            if (!apiUrl) {
                document.getElementById('authModal').classList.add('hidden');
                document.getElementById('appContainer').classList.remove('hidden');
                initApp();
                return false;
            }
            
            if (token) {
                try {
                    const parts = atob(token).split('-');
                    if (parts.length === 2) {
                        const timestamp = parseInt(parts[0]);
                        const now = Date.now();
                        if (now - timestamp < 8 * 60 * 60 * 1000) {
                            document.getElementById('authModal').classList.add('hidden');
                            document.getElementById('appContainer').classList.remove('hidden');
                            initApp();
                            return true;
                        }
                    }
                } catch (e) {
                    console.error('TokenéªŒè¯å¤±è´¥:', e);
                }
            }
            
            document.getElementById('authModal').classList.remove('hidden');
            document.getElementById('appContainer').classList.add('hidden');
            
            const lockoutCheck = checkLockout();
            if (lockoutCheck.locked) {
                const attemptsCount = document.getElementById('attemptsCount');
                attemptsCount.innerHTML = `è´¦æˆ·å·²é”å®šï¼Œ${lockoutCheck.remainingMinutes}åˆ†é’Ÿåé‡è¯•`;
                document.getElementById('authPassword').disabled = true;
                document.getElementById('verifyBtn').disabled = true;
            } else {
                const remaining = getRemainingAttempts();
                const attemptsCount = document.getElementById('attemptsCount');
                attemptsCount.innerHTML = `å‰©ä½™å°è¯•æ¬¡æ•°: ${remaining}`;
                document.getElementById('authPassword').disabled = false;
                document.getElementById('verifyBtn').disabled = false;
            }
            
            return false;
        }

        // ==================== è§†å›¾æ¸²æŸ“å‡½æ•° ====================
        function renderWelcomeView() {
            app.innerHTML = `
            <div class="glass p-12 rounded-[3rem] text-center space-y-8 animate-in fade-in zoom-in duration-700">
                <div class="inline-flex p-5 bg-gradient-to-r from-blue-500 to-purple-600 rounded-full text-5xl">ğŸš€</div>
                <div class="space-y-2">
                    <h1 class="text-4xl font-extrabold tracking-tight italic">CloudNotes</h1>
                    <p class="text-slate-400 leading-relaxed">æ‚¨çš„ä¸“å±åŠ å¯†ç¬”è®°ä¸ä¸ªäººå¯¼èˆªç³»ç»Ÿ<br>è¯·å…ˆå…³è”æ‚¨çš„ Cloudflare Worker åç«¯</p>
                </div>
                <button onclick="configUrl()" class="px-10 py-5 gradient-btn text-white font-black rounded-3xl shadow-2xl">åˆå§‹åŒ–é…ç½®</button>
            </div>
        `;
        }

        function renderMainView() {
            app.innerHTML = `
            <div class="space-y-12 animate-in fade-in slide-in-from-bottom-4 duration-700">
                <header class="flex justify-between items-end">
                    <div class="space-y-1">
                        <h1 class="text-4xl font-extrabold tracking-tighter bg-gradient-to-r from-white to-slate-500 bg-clip-text text-transparent">CloudNotes</h1>
                        <p class="text-[10px] uppercase tracking-[0.3em] text-blue-500 font-black">ç«¯åˆ°ç«¯åŠ å¯†ç¬”è®° | ä¸ªäººå¯¼èˆªä¸­å¿ƒ | å›¾ç‰‡å­˜å‚¨</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <div class="flex gap-2">
                            <button onclick="switchView('notes')" class="px-4 py-2 rounded-xl ${currentView === 'notes' ? 'gradient-btn text-white' : 'glass text-slate-400'} transition">ğŸ“ ç¬”è®°</button>
                            <button onclick="switchView('nav')" class="px-4 py-2 rounded-xl ${currentView === 'nav' ? 'nav-gradient text-white' : 'glass text-slate-400'} transition">ğŸ”— å¯¼èˆª</button>
                            <button onclick="switchView('images')" class="px-4 py-2 rounded-xl ${currentView === 'images' ? 'bg-emerald-600 text-white' : 'glass text-slate-400'} transition">ğŸ–¼ï¸ å›¾ç‰‡</button>
                        </div>
                        <button onclick="logout()" class="text-xs text-slate-400 hover:text-white transition px-3 py-1 glass rounded-full" title="é€€å‡ºç™»å½•">
                            é€€å‡º
                        </button>
                        <button onclick="configUrl()" class="p-4 glass rounded-2xl hover:rotate-180 transition-all duration-500 text-xl">âš™ï¸</button>
                    </div>
                </header>

                <div id="notesView" class="${currentView === 'notes' ? '' : 'hidden'}">
                    <main class="glass p-8 rounded-[2.5rem] shadow-2xl space-y-6 border-white/5 mb-8">
                        <div class="space-y-4">
                            <div>
                                <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 mb-2 block">
                                    è§£å¯†ä¸»å¯†ç 
                                </label>
                                <form id="mainPasswordForm" onsubmit="event.preventDefault();">
                                    <input id="mainPw" type="password" placeholder="è¾“å…¥ä¸»å¯†ç ä»¥åŠ å¯†/è§£å¯†æ•°æ®" 
                                        class="w-full bg-slate-950/50 border border-slate-800 p-4 rounded-2xl outline-none focus:ring-2 ring-blue-500/50 transition-all font-mono">
                            </div>
                            
                            <div>
                                <div class="flex justify-between items-center mb-2">
                                    <label class="text-[10px] uppercase tracking-widest text-slate-400 font-bold ml-1 block">
                                        ç¬”è®°å†…å®¹ (æ”¯æŒ Markdown æ ¼å¼)
                                    </label>
                                    <div class="flex gap-2">
                                        <button onclick="showMarkdownHelp()" class="text-xs text-blue-400 hover:text-blue-300 transition">ğŸ“– è¯­æ³•å¸®åŠ©</button>
                                        <button onclick="showImageManagerModal()" class="text-xs text-emerald-400 hover:text-emerald-300 transition">ğŸ–¼ï¸ å›¾ç‰‡ç®¡ç†</button>
                                    </div>
                                </div>
                                <textarea id="noteInput" placeholder="# è¾“å…¥æ‚¨çš„ Markdown ç¬”è®°...&#10;&#10;## æ”¯æŒåŠŸèƒ½&#10;- æ ‡é¢˜ã€åˆ—è¡¨ã€ä»£ç å—&#10;- **ç²—ä½“**ã€*æ–œä½“*ã€[é“¾æ¥]()&#10;- è¡¨æ ¼ã€å¼•ç”¨ã€åˆ†å‰²çº¿&#10;- å›¾ç‰‡ä¸Šä¼ ä¸åµŒå…¥" 
                                    class="w-full bg-slate-950/50 border border-slate-800 p-5 h-64 rounded-2xl outline-none focus:bg-slate-950 transition-all resize-none leading-relaxed font-mono"></textarea>
                                <div class="flex items-center gap-2 text-xs text-slate-500 mt-2">
                                    <span id="noteCharCount">0</span> å­—ç¬¦
                                </div>
                            </div>
                        </div>
                        
                        <div class="grid grid-cols-3 gap-4">
                            <button onclick="doSave()" class="gradient-btn text-white py-5 rounded-2xl font-black tracking-widest uppercase text-xs hover:shadow-lg transition">åŠ å¯†å­˜å…¥äº‘ç«¯</button>
                            <button onclick="doAI()" class="glass text-purple-400 py-5 rounded-2xl font-black tracking-widest uppercase text-xs hover:bg-purple-500/10 transition border-purple-500/20">âœ¨ AI æ™ºèƒ½æ€»ç»“</button>
                            <button onclick="showImageUploadModal()" class="bg-emerald-600 text-white py-5 rounded-2xl font-black tracking-widest uppercase text-xs hover:bg-emerald-700 transition">ğŸ–¼ï¸ ä¸Šä¼ å›¾ç‰‡</button>
                        </div>
                    </main>

                    <section class="space-y-6">
                        <div class="flex justify-between items-center px-4">
                            <h2 class="text-xs font-black uppercase tracking-[0.2em] text-slate-500 italic">Vault / æˆ‘çš„åŠ å¯†åº“</h2>
                            <div class="flex gap-2">
                                <button onclick="showMarkdownHelp()" class="text-blue-400 text-xs font-black hover:underline">Markdown è¯­æ³•</button>
                                <button onclick="loadNotesList()" class="text-blue-500 text-xs font-black hover:underline uppercase">åˆ·æ–°åˆ—è¡¨</button>
                            </div>
                        </div>
                        <div id="notesList" class="space-y-6">
                            <div class="text-center py-20 text-slate-600 italic text-sm">é…ç½®å®Œæˆåè¾“å…¥å¯†ç å¹¶ç‚¹å‡»åˆ·æ–°ã€‚</div>
                        </div>
                    </section>
                </div>

                <div id="navView" class="${currentView === 'nav' ? '' : 'hidden'}">
                    <main class="glass p-8 rounded-[2.5rem] shadow-2xl space-y-6 border-white/5 mb-8">
                        <div class="space-y-4">
                            <div class="text-center space-y-2">
                                <h2 class="text-2xl font-extrabold tracking-tight text-purple-300">ğŸ”— ä¸ªäººå¯¼èˆªä¸­å¿ƒ</h2>
                                <p class="text-slate-400 text-sm">ç®¡ç†æ‚¨çš„å¸¸ç”¨é“¾æ¥ï¼Œå¿«é€Ÿè®¿é—®é‡è¦èµ„æº</p>
                            </div>
                            
                            <div class="flex flex-wrap gap-3 justify-center">
                                <button onclick="showAddNavLinkModal()" class="px-6 py-3 nav-gradient text-white rounded-2xl font-bold hover:shadow-lg transition flex items-center gap-2">
                                    <i class="fas fa-plus"></i> æ·»åŠ é“¾æ¥
                                </button>
                                <button onclick="loadNavLinks()" class="px-6 py-3 glass text-purple-400 rounded-2xl font-bold hover:bg-purple-500/10 transition flex items-center gap-2">
                                    <i class="fas fa-sync-alt"></i> åˆ·æ–°åˆ—è¡¨
                                </button>
                                <button onclick="exportNavLinks()" class="px-6 py-3 glass text-emerald-400 rounded-2xl font-bold hover:bg-emerald-500/10 transition flex items-center gap-2">
                                    <i class="fas fa-download"></i> å¯¼å‡ºå¤‡ä»½
                                </button>
                            </div>
                        </div>
                    </main>

                    <section class="space-y-8">
                        <div class="flex justify-between items-center px-4">
                            <h2 class="text-xs font-black uppercase tracking-[0.2em] text-slate-500 italic">Navigation / æˆ‘çš„é“¾æ¥åº“</h2>
                            <div class="text-xs text-slate-500" id="navStats">
                            </div>
                        </div>
                        
                        <div id="navCategories" class="space-y-8">
                            <div class="text-center py-20 text-slate-600 italic text-sm">ç‚¹å‡»"åˆ·æ–°åˆ—è¡¨"åŠ è½½æ‚¨çš„å¯¼èˆªé“¾æ¥</div>
                        </div>
                    </section>
                </div>

                <div id="imagesView" class="${currentView === 'images' ? '' : 'hidden'}">
                    <main class="glass p-8 rounded-[2.5rem] shadow-2xl space-y-6 border-white/5 mb-8">
                        <div class="space-y-4">
                            <div class="text-center space-y-2">
                                <h2 class="text-2xl font-extrabold tracking-tight text-emerald-300">ğŸ–¼ï¸ å›¾ç‰‡ç®¡ç†ä¸­å¿ƒ</h2>
                                <p class="text-slate-400 text-sm">ä¸Šä¼ ã€ç®¡ç†å’ŒåµŒå…¥å›¾ç‰‡åˆ°æ‚¨çš„ç¬”è®°ä¸­</p>
                            </div>
                            
                            <div class="flex flex-wrap gap-3 justify-center">
                                <button onclick="showImageUploadModal()" class="px-6 py-3 bg-emerald-600 text-white rounded-2xl font-bold hover:bg-emerald-700 transition flex items-center gap-2">
                                    <i class="fas fa-cloud-upload-alt"></i> ä¸Šä¼ å›¾ç‰‡
                                </button>
                                <button onclick="loadImages()" class="px-6 py-3 glass text-emerald-400 rounded-2xl font-bold hover:bg-emerald-500/10 transition flex items-center gap-2">
                                    <i class="fas fa-sync-alt"></i> åˆ·æ–°åˆ—è¡¨
                                </button>
                                <button onclick="showImageManagerModal()" class="px-6 py-3 glass text-purple-400 rounded-2xl font-bold hover:bg-purple-500/10 transition flex items-center gap-2">
                                    <i class="fas fa-images"></i> å›¾ç‰‡ç®¡ç†å™¨
                                </button>
                            </div>
                        </div>
                    </main>

                    <section class="space-y-8">
                        <div class="flex justify-between items-center px-4">
                            <h2 class="text-xs font-black uppercase tracking-[0.2em] text-slate-500 italic">Images / æˆ‘çš„å›¾ç‰‡åº“</h2>
                            <div class="text-xs text-slate-500" id="imageStats">
                            </div>
                        </div>
                        
                        <div id="imagesGrid" class="space-y-8">
                            <div class="text-center py-20 text-slate-600 italic text-sm">ç‚¹å‡»"ä¸Šä¼ å›¾ç‰‡"æˆ–"åˆ·æ–°åˆ—è¡¨"å¼€å§‹</div>
                        </div>
                    </section>
                </div>
                
                <footer class="text-center pt-8 pb-4 opacity-50 hover:opacity-100 transition duration-500">
                    <span class="text-3xl font-black uppercase tracking-widest text-red-500">
                        è’¼å¤©å·²æ­»ï¼Œé»ƒå¤©ç•¶ç«‹
                    </span>
                </footer>
            </div>
        `;
            
            // æ·»åŠ å­—ç¬¦è®¡æ•°ç›‘å¬
            const noteInput = document.getElementById('noteInput');
            const noteCharCount = document.getElementById('noteCharCount');
            if (noteInput && noteCharCount) {
                noteInput.addEventListener('input', function() {
                    noteCharCount.textContent = this.value.length;
                });
            }
            
            // åŠ è½½é»˜è®¤è§†å›¾æ•°æ®
            if (currentView === 'notes') {
                // é»˜è®¤ä¸åŠ è½½ï¼Œç­‰å¾…ç”¨æˆ·è¾“å…¥å¯†ç 
            } else if (currentView === 'nav') {
                loadNavLinks();
            } else if (currentView === 'images') {
                loadImages();
            }
            
            // æ˜¾ç¤ºå¿«é€Ÿè®¿é—®æ 
            document.getElementById('quickAccessBar').classList.remove('hidden');
        }

        function renderShareView() {
            app.innerHTML = `
            <div class="space-y-12 animate-in fade-in slide-in-from-bottom-4 duration-700">
                <header class="flex justify-between items-end">
                    <div class="space-y-1">
                        <h1 class="text-4xl font-extrabold tracking-tighter bg-gradient-to-r from-orange-500 to-red-500 bg-clip-text text-transparent">CloudNotes</h1>
                        <p class="text-[10px] uppercase tracking-[0.3em] text-orange-500 font-black">é˜…åå³ç„š | åˆ†äº«è§£å¯†</p>
                    </div>
                    <div class="flex items-center gap-4">
                        <button onclick="window.location.href = window.location.origin + window.location.pathname" 
                                class="text-xs text-slate-400 hover:text-white transition px-3 py-1 glass rounded-full" 
                                title="è¿”å›ä¸»é¡µ">
                            è¿”å›ä¸»é¡µ
                        </button>
                    </div>
                </header>

                <main class="glass p-12 rounded-[3rem] shadow-2xl text-center space-y-8">
                    <div class="text-6xl animate-bounce">ğŸ”¥</div>
                    <div class="space-y-2">
                        <h1 class="text-3xl font-black italic">é˜…åå³ç„šè§£å¯†</h1>
                        <p class="text-slate-400 text-sm">è§£å¯†åæ•°æ®å°†ç«‹å³ä»æœåŠ¡å™¨ç‰©ç†æ“¦é™¤</p>
                    </div>
                    <input id="sharePw" type="password" placeholder="è¯·è¾“å…¥ 6 ä½ä»¥ä¸Šè§£å¯†å¯†ç " 
                           class="w-full bg-slate-950/50 border border-slate-800 p-5 rounded-2xl outline-none focus:ring-2 ring-orange-500/50 text-center font-mono">
                    <button id="unlockBtn" onclick="doUnlockShare()" 
                            class="w-full share-gradient text-white py-5 rounded-2xl font-black uppercase tracking-widest shadow-xl hover:scale-[1.02] transition">
                        è§£å¯†å¹¶é”€æ¯
                    </button>
                    <div id="shareResult" class="mt-8 hidden">
                        <div class="text-left p-6 bg-slate-950/50 rounded-2xl border border-orange-500/20 ring-1 ring-orange-500/10 shadow-inner leading-relaxed">
                            <div class="flex justify-between items-center mb-4">
                                <span class="text-xs uppercase tracking-widest text-slate-400 font-bold">é˜…åå³ç„šå†…å®¹</span>
                                <button onclick="startBurnAnimation()" id="burnNowBtn" class="text-xs text-orange-500 hover:text-red-500 transition font-bold uppercase tracking-widest flex items-center gap-2">
                                    <i class="fas fa-fire"></i>
                                    <span>ç«‹å³ç„šæ¯</span>
                                </button>
                            </div>
                            <div id="burningContent" class="markdown-preview relative"></div>
                            <div class="mt-4 pt-4 border-t border-orange-500/10 space-y-2">
                                <div class="flex items-center justify-between">
                                    <div id="burnProgress" class="text-xs text-slate-500">
                                        å·²ç„šæ¯: <span id="charsBurned">0</span>/<span id="totalChars">0</span>
                                        <span id="burnPercentage" class="ml-2 text-orange-500">0%</span>
                                    </div>
                                    <div id="burnTimer" class="text-xs text-orange-500 hidden flex items-center gap-2">
                                        <i class="fas fa-clock animate-pulse"></i>
                                        <span id="timeLeft">10</span>ç§’åè‡ªåŠ¨ç„šæ¯
                                    </div>
                                </div>
                                <div class="w-full bg-slate-800/50 h-2 rounded-full overflow-hidden">
                                    <div id="burnProgressBar" class="h-full bg-gradient-to-r from-orange-500 to-red-500 rounded-full transition-all duration-300" style="width: 0%"></div>
                                </div>
                                <div class="text-xs text-slate-500 flex justify-between">
                                    <span>å¼€å§‹</span>
                                    <span id="burnSpeed">é€Ÿåº¦: ä¸­</span>
                                    <span>ç»“æŸ</span>
                                </div>
                            </div>
                        </div>
                    </div>
                </main>
                
                <footer class="text-center pt-8 pb-4 opacity-50 hover:opacity-100 transition duration-500">
                    <span class="text-3xl font-black uppercase tracking-widest text-red-500">
                        è’¼å¤©å·²æ­»ï¼Œé»ƒå¤©ç•¶ç«‹
                    </span>
                </footer>
            </div>
        `;
            
            // æ·»åŠ å›è½¦é”®æ”¯æŒ
            const sharePwInput = document.getElementById('sharePw');
            if (sharePwInput) {
                sharePwInput.addEventListener('keydown', function(event) {
                    if (event.key === 'Enter') {
                        doUnlockShare();
                    }
                });
            }
        }

        // ==================== è§†å›¾åˆ‡æ¢ ====================
        function switchView(view) {
            currentView = view;
            renderMainView();
        }

        // ==================== å›¾ç‰‡ä¸Šä¼ åŠŸèƒ½ ====================
        function showImageUploadModal() {
            selectedImages = [];
            isUploading = false;
            
            document.getElementById('imageUploadModal').classList.remove('hidden');
            document.getElementById('imageUploadArea').className = 'image-upload-area';
            document.getElementById('imagePreviews').classList.add('hidden');
            document.getElementById('imagePreviews').innerHTML = '';
            document.getElementById('uploadProgress').classList.add('hidden');
            document.getElementById('uploadStatus').innerHTML = '';
            document.getElementById('uploadBtn').disabled = false;
            document.getElementById('uploadBtn').innerHTML = 'å¼€å§‹ä¸Šä¼ ';
            
            // é‡ç½®æ–‡ä»¶è¾“å…¥
            const fileInput = document.getElementById('imageFileInput');
            fileInput.value = '';
        }
        
        function closeImageUploadModal() {
            if (isUploading) {
                if (!confirm('ä¸Šä¼ æ­£åœ¨è¿›è¡Œä¸­ï¼Œç¡®å®šè¦å–æ¶ˆå—ï¼Ÿ')) {
                    return;
                }
            }
            document.getElementById('imageUploadModal').classList.add('hidden');
        }
        
        function showImageUploadInEditor() {
            showImageUploadModal();
            // æ ‡è®°è¿™æ˜¯ä»ç¼–è¾‘å™¨å†…è§¦å‘çš„ä¸Šä¼ 
            document.getElementById('imageUploadModal').dataset.fromEditor = 'true';
        }
        
        function handleDragOver(event) {
            event.preventDefault();
            event.stopPropagation();
            event.dataTransfer.dropEffect = 'copy';
            document.getElementById('imageUploadArea').classList.add('dragover');
        }
        
        function handleDragLeave(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('imageUploadArea').classList.remove('dragover');
        }
        
        function handleDrop(event) {
            event.preventDefault();
            event.stopPropagation();
            document.getElementById('imageUploadArea').classList.remove('dragover');
            
            const files = event.dataTransfer.files;
            handleFiles(files);
        }
        
        function handleFileSelect(event) {
            const files = event.target.files;
            handleFiles(files);
        }
        
        function handleFiles(files) {
            if (files.length === 0) return;
            
            // æ¸…ç©ºä¹‹å‰çš„é¢„è§ˆ
            selectedImages = [];
            const previewsContainer = document.getElementById('imagePreviews');
            previewsContainer.innerHTML = '';
            
            let validFiles = 0;
            const maxSize = 5 * 1024 * 1024; // 5MB
            const allowedTypes = ['image/jpeg', 'image/jpg', 'image/png', 'image/gif', 'image/webp'];
            
            for (let i = 0; i < files.length; i++) {
                const file = files[i];
                
                // éªŒè¯æ–‡ä»¶ç±»å‹
                if (!allowedTypes.includes(file.type)) {
                    showUploadStatus(`æ–‡ä»¶ "${file.name}" ç±»å‹ä¸æ”¯æŒï¼Œåªæ”¯æŒ JPG, PNG, GIF, WebP æ ¼å¼`, 'error');
                    continue;
                }
                
                // éªŒè¯æ–‡ä»¶å¤§å°
                if (file.size > maxSize) {
                    showUploadStatus(`æ–‡ä»¶ "${file.name}" å¤§å°è¶…è¿‡ 5MB é™åˆ¶`, 'error');
                    continue;
                }
                
                validFiles++;
                
                // åˆ›å»ºé¢„è§ˆ
                const reader = new FileReader();
                reader.onload = function(e) {
                    const previewItem = document.createElement('div');
                    previewItem.className = 'image-preview-item';
                    previewItem.dataset.index = selectedImages.length;
                    
                    previewItem.innerHTML = `
                        <img src="${e.target.result}" alt="${file.name}">
                        <div class="image-preview-overlay">
                            <div class="image-preview-actions">
                                <button onclick="removePreview(${selectedImages.length})" class="image-preview-btn delete" title="ç§»é™¤">
                                    <i class="fas fa-trash"></i>
                                </button>
                            </div>
                        </div>
                        <div class="image-info">
                            <div class="truncate">${file.name}</div>
                            <div class="text-xs">${formatFileSize(file.size)}</div>
                        </div>
                    `;
                    
                    previewsContainer.appendChild(previewItem);
                    previewsContainer.classList.remove('hidden');
                    
                    // æ·»åŠ åˆ°å¾…ä¸Šä¼ åˆ—è¡¨
                    selectedImages.push({
                        file: file,
                        preview: e.target.result,
                        name: file.name,
                        size: file.size
                    });
                };
                
                reader.readAsDataURL(file);
            }
            
            if (validFiles > 0) {
                showUploadStatus(`å·²é€‰æ‹© ${validFiles} ä¸ªæ–‡ä»¶ï¼Œå‡†å¤‡ä¸Šä¼ `, 'success');
                document.getElementById('uploadBtn').disabled = false;
            }
        }
        
        function removePreview(index) {
            // ä»é¢„è§ˆä¸­ç§»é™¤
            const previewItem = document.querySelector(`.image-preview-item[data-index="${index}"]`);
            if (previewItem) {
                previewItem.remove();
            }
            
            // ä»æ•°ç»„ä¸­ç§»é™¤
            selectedImages.splice(index, 1);
            
            // æ›´æ–°æ‰€æœ‰é¢„è§ˆé¡¹çš„ç´¢å¼•
            const previewItems = document.querySelectorAll('.image-preview-item');
            previewItems.forEach((item, i) => {
                item.dataset.index = i;
            });
            
            if (selectedImages.length === 0) {
                document.getElementById('imagePreviews').classList.add('hidden');
                showUploadStatus('', '');
            } else {
                showUploadStatus(`å·²é€‰æ‹© ${selectedImages.length} ä¸ªæ–‡ä»¶ï¼Œå‡†å¤‡ä¸Šä¼ `, 'success');
            }
        }
        
        function formatFileSize(bytes) {
            if (bytes === 0) return '0 Bytes';
            const k = 1024;
            const sizes = ['Bytes', 'KB', 'MB', 'GB'];
            const i = Math.floor(Math.log(bytes) / Math.log(k));
            return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + ' ' + sizes[i];
        }
        
        function showUploadStatus(message, type) {
            const statusDiv = document.getElementById('uploadStatus');
            statusDiv.innerHTML = '';
            
            if (!message) return;
            
            let icon = '';
            let colorClass = '';
            
            switch (type) {
                case 'error':
                    icon = 'fa-exclamation-circle';
                    colorClass = 'text-red-400';
                    break;
                case 'success':
                    icon = 'fa-check-circle';
                    colorClass = 'text-emerald-400';
                    break;
                case 'warning':
                    icon = 'fa-exclamation-triangle';
                    colorClass = 'text-yellow-400';
                    break;
                default:
                    icon = 'fa-info-circle';
                    colorClass = 'text-blue-400';
            }
            
            statusDiv.innerHTML = `
                <div class="flex items-center gap-2 justify-center ${colorClass}">
                    <i class="fas ${icon}"></i>
                    <span>${message}</span>
                </div>
            `;
        }
        
        async function startImageUpload() {
            if (selectedImages.length === 0) {
                showUploadStatus('è¯·å…ˆé€‰æ‹©è¦ä¸Šä¼ çš„å›¾ç‰‡', 'error');
                return;
            }
            
            if (isUploading) {
                return;
            }
            
            isUploading = true;
            const uploadBtn = document.getElementById('uploadBtn');
            const progressDiv = document.getElementById('uploadProgress');
            const progressFill = document.getElementById('uploadProgressFill');
            const percentageSpan = document.getElementById('uploadPercentage');
            
            uploadBtn.disabled = true;
            uploadBtn.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ä¸Šä¼ ä¸­...';
            progressDiv.classList.remove('hidden');
            
            let uploadedCount = 0;
            let totalCount = selectedImages.length;
            let uploadedUrls = [];
            
            for (let i = 0; i < selectedImages.length; i++) {
                const image = selectedImages[i];
                
                try {
                    const formData = new FormData();
                    formData.append('file', image.file);
                    formData.append('name', image.name);
                    formData.append('size', image.size);
                    
                    const response = await fetch(`${API_URL}/api/images/upload`, {
                        method: 'POST',
                        headers: {
                            'Authorization': ADMIN_KEY
                        },
                        body: formData
                    });
                    
                    if (!response.ok) {
                        throw new Error(`ä¸Šä¼ å¤±è´¥: ${response.statusText}`);
                    }
                    
                    const result = await response.json();
                    
                    uploadedCount++;
                    const progress = Math.round((uploadedCount / totalCount) * 100);
                    
                    progressFill.style.width = `${progress}%`;
                    percentageSpan.textContent = `${progress}%`;
                    
                    if (result.url) {
                        uploadedUrls.push({
                            url: result.url,
                            name: image.name,
                            markdown: `![${image.name}](${result.url})`
                        });
                    }
                    
                    // æ›´æ–°é¢„è§ˆçŠ¶æ€
                    const previewItem = document.querySelector(`.image-preview-item[data-index="${i}"]`);
                    if (previewItem) {
                        previewItem.classList.add('success');
                        previewItem.querySelector('.image-preview-overlay').innerHTML = `
                            <div class="image-preview-actions">
                                <button onclick="copyImageUrl('${result.url}')" class="image-preview-btn copy" title="å¤åˆ¶é“¾æ¥">
                                    <i class="fas fa-copy"></i>
                                </button>
                            </div>
                        `;
                    }
                    
                } catch (error) {
                    console.error('ä¸Šä¼ å¤±è´¥:', error);
                    const previewItem = document.querySelector(`.image-preview-item[data-index="${i}"]`);
                    if (previewItem) {
                        previewItem.classList.add('error');
                    }
                    showUploadStatus(`å›¾ç‰‡ "${image.name}" ä¸Šä¼ å¤±è´¥: ${error.message}`, 'error');
                }
            }
            
            // ä¸Šä¼ å®Œæˆ
            isUploading = false;
            uploadBtn.disabled = false;
            uploadBtn.innerHTML = 'å¼€å§‹ä¸Šä¼ ';
            
            if (uploadedCount > 0) {
                showUploadStatus(`æˆåŠŸä¸Šä¼  ${uploadedCount}/${totalCount} ä¸ªæ–‡ä»¶`, 'success');
                
                // å¦‚æœæ˜¯ä»ç¼–è¾‘å™¨å†…è§¦å‘çš„ä¸Šä¼ ï¼Œå°†Markdownæ’å…¥ç¼–è¾‘å™¨
                const fromEditor = document.getElementById('imageUploadModal').dataset.fromEditor === 'true';
                if (fromEditor && uploadedUrls.length > 0) {
                    insertImageMarkdownToEditor(uploadedUrls);
                }
                
                // åˆ·æ–°å›¾ç‰‡åˆ—è¡¨
                if (currentView === 'images') {
                    loadImages();
                }
                
                // 3ç§’åè‡ªåŠ¨å…³é—­æ¨¡æ€æ¡†
                setTimeout(() => {
                    if (uploadedCount === totalCount) {
                        closeImageUploadModal();
                    }
                }, 3000);
            }
        }
        
        function insertImageMarkdownToEditor(imageUrls) {
            const textarea = document.getElementById('editNoteContent');
            if (!textarea) return;
            
            let markdownText = '';
            imageUrls.forEach(img => {
                markdownText += img.markdown + '\n\n';
            });
            
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const currentText = textarea.value;
            
            textarea.value = currentText.substring(0, start) + markdownText + currentText.substring(end);
            textarea.selectionStart = start + markdownText.length;
            textarea.selectionEnd = start + markdownText.length;
            textarea.focus();
            
            updateCharCount();
            
            // åˆ‡æ¢å›ç¼–è¾‘æ¨¡å¼
            switchTab('edit');
        }
        
        function copyImageUrl(url) {
            navigator.clipboard.writeText(url)
                .then(() => {
                    showToast('å›¾ç‰‡é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                })
                .catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    showToast('å¤åˆ¶å¤±è´¥', 'error');
                });
        }
        
        // ==================== å›¾ç‰‡ç®¡ç†åŠŸèƒ½ ====================
        async function loadImages() {
            if (currentView !== 'images') return;
            
            const imagesGrid = document.getElementById('imagesGrid');
            if (!imagesGrid) return;
            
            imagesGrid.innerHTML = '<div class="text-center py-12 text-slate-600 italic text-sm">åŠ è½½ä¸­...</div>';
            
            try {
                const response = await fetch(`${API_URL}/api/images/list`, {
                    headers: { 'Authorization': ADMIN_KEY }
                });
                
                if (!response.ok) {
                    throw new Error('è·å–å›¾ç‰‡åˆ—è¡¨å¤±è´¥');
                }
                
                const images = await response.json();
                
                if (images.length === 0) {
                    imagesGrid.innerHTML = `
                        <div class="text-center py-20 space-y-4">
                            <div class="text-5xl text-slate-700">ğŸ–¼ï¸</div>
                            <p class="text-slate-600 italic">æš‚æ— å›¾ç‰‡ï¼Œç‚¹å‡»"ä¸Šä¼ å›¾ç‰‡"å¼€å§‹ä¸Šä¼ </p>
                        </div>
                    `;
                    document.getElementById('imageStats').textContent = '0 å¼ å›¾ç‰‡';
                    return;
                }
                
                let html = '';
                
                // æŒ‰æ—¥æœŸåˆ†ç»„
                const groupedImages = {};
                images.forEach(image => {
                    const date = new Date(image.created_at).toLocaleDateString();
                    if (!groupedImages[date]) {
                        groupedImages[date] = [];
                    }
                    groupedImages[date].push(image);
                });
                
                const dates = Object.keys(groupedImages).sort((a, b) => new Date(b) - new Date(a));
                
                dates.forEach(date => {
                    const dateImages = groupedImages[date];
                    
                    html += `
                        <div class="space-y-4">
                            <h3 class="text-lg font-bold text-slate-300 flex items-center gap-2">
                                <span class="category-tag bg-emerald-900/30 text-emerald-400">${date}</span>
                                <span class="text-sm text-slate-500">(${dateImages.length}å¼ å›¾ç‰‡)</span>
                            </h3>
                            <div class="image-grid">
                    `;
                    
                    dateImages.forEach(image => {
                        const imageName = image.name || 'æœªå‘½åå›¾ç‰‡';
                        const imageSize = formatFileSize(image.size || 0);
                        
                        html += `
                            <div class="image-manager-card">
                                <div class="relative">
                                    <img src="${image.url}" alt="${imageName}" 
                                         class="image-manager-thumbnail cursor-pointer"
                                         onclick="openImagePreview('${image.url}')"
                                         onerror="this.src='data:image/svg+xml,<svg xmlns=\"http://www.w3.org/2000/svg\" viewBox=\"0 0 24 24\" fill=\"%236b7280\"><path d=\"M19 5v14H5V5h14m0-2H5c-1.1 0-2 .9-2 2v14c0 1.1.9 2 2 2h14c1.1 0 2-.9 2-2V5c0-1.1-.9-2-2-2zm-4.86 8.86l-3 3.87L9 13.14 6 17h12l-3.86-5.14z\"/></svg>'">
                                    <div class="absolute top-2 right-2 flex gap-1">
                                        <button onclick="copyImageMarkdown('${image.url}', '${imageName}')" 
                                                class="p-1 bg-black/60 rounded text-white hover:bg-black/80 transition"
                                                title="å¤åˆ¶Markdown">
                                            <i class="fas fa-code text-xs"></i>
                                        </button>
                                        <button onclick="deleteImage(${image.id})" 
                                                class="p-1 bg-red-600/60 rounded text-white hover:bg-red-600/80 transition"
                                                title="åˆ é™¤å›¾ç‰‡">
                                            <i class="fas fa-trash text-xs"></i>
                                        </button>
                                    </div>
                                </div>
                                <div class="image-manager-info">
                                    <div class="font-medium text-slate-200 truncate">${imageName}</div>
                                    <div class="image-manager-meta">
                                        <span class="image-size">${imageSize}</span>
                                        <span class="text-xs">${new Date(image.created_at).toLocaleTimeString([], {hour: '2-digit', minute:'2-digit'})}</span>
                                    </div>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
                
                imagesGrid.innerHTML = html;
                document.getElementById('imageStats').textContent = `${images.length} å¼ å›¾ç‰‡ï¼Œ${dates.length} ä¸ªæ—¥æœŸ`;
                
            } catch (error) {
                console.error('åŠ è½½å›¾ç‰‡å¤±è´¥:', error);
                imagesGrid.innerHTML = `
                    <div class="text-center py-20 text-slate-700 italic text-sm">
                        åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–é…ç½®
                    </div>
                `;
            }
        }
        
        function copyImageMarkdown(url, name) {
            const markdown = `![${name}](${url})`;
            navigator.clipboard.writeText(markdown)
                .then(() => {
                    showToast('Markdownå·²å¤åˆ¶åˆ°å‰ªè´´æ¿', 'success');
                })
                .catch(err => {
                    console.error('å¤åˆ¶å¤±è´¥:', err);
                    showToast('å¤åˆ¶å¤±è´¥', 'error');
                });
        }
        
        async function deleteImage(id) {
            if (!confirm('ç¡®å®šè¦åˆ é™¤è¿™å¼ å›¾ç‰‡å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚')) {
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/images/delete`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': ADMIN_KEY
                    },
                    body: JSON.stringify({ id })
                });
                
                if (response.ok) {
                    showToast('å›¾ç‰‡å·²åˆ é™¤', 'success');
                    loadImages();
                } else {
                    throw new Error('åˆ é™¤å¤±è´¥');
                }
            } catch (error) {
                console.error('åˆ é™¤å›¾ç‰‡å¤±è´¥:', error);
                showToast('åˆ é™¤å¤±è´¥', 'error');
            }
        }
        
        function openImagePreview(url) {
            window.open(url, '_blank');
        }
        
        // ==================== å›¾ç‰‡ç®¡ç†å™¨æ¨¡æ€æ¡†åŠŸèƒ½ ====================
        function showImageManagerModal() {
            document.getElementById('imageManagerModal').classList.remove('hidden');
            refreshImageList();
        }
        
        function closeImageManagerModal() {
            document.getElementById('imageManagerModal').classList.add('hidden');
        }
        
        async function refreshImageList() {
            const contentDiv = document.getElementById('imageManagerContent');
            contentDiv.innerHTML = '<div class="text-center py-12 text-slate-600 italic text-sm">åŠ è½½ä¸­...</div>';
            
            try {
                const response = await fetch(`${API_URL}/api/images/list`, {
                    headers: { 'Authorization': ADMIN_KEY }
                });
                
                if (!response.ok) {
                    throw new Error('è·å–å›¾ç‰‡åˆ—è¡¨å¤±è´¥');
                }
                
                const images = await response.json();
                
                if (images.length === 0) {
                    contentDiv.innerHTML = `
                        <div class="text-center py-20 space-y-4">
                            <div class="text-5xl text-slate-700">ğŸ–¼ï¸</div>
                            <p class="text-slate-600 italic">æš‚æ— å›¾ç‰‡</p>
                            <button onclick="showImageUploadModal()" class="px-4 py-2 bg-emerald-600 text-white rounded-lg hover:bg-emerald-700 transition">
                                ä¸Šä¼ å›¾ç‰‡
                            </button>
                        </div>
                    `;
                    return;
                }
                
                let html = `
                    <div class="grid grid-cols-2 md:grid-cols-3 lg:grid-cols-4 gap-4">
                `;
                
                images.forEach(image => {
                    const imageName = image.name || 'æœªå‘½åå›¾ç‰‡';
                    const imageSize = formatFileSize(image.size || 0);
                    
                    html += `
                        <div class="image-manager-card">
                            <div class="relative">
                                <img src="${image.url}" alt="${imageName}" 
                                     class="image-manager-thumbnail cursor-pointer"
                                     onclick="openImagePreview('${image.url}')">
                                <div class="absolute top-2 right-2 flex gap-1">
                                    <button onclick="copyImageMarkdown('${image.url}', '${imageName}')" 
                                            class="p-1 bg-black/60 rounded text-white hover:bg-black/80 transition"
                                            title="å¤åˆ¶Markdown">
                                        <i class="fas fa-code text-xs"></i>
                                    </button>
                                    <button onclick="insertImageToEditor('${image.url}', '${imageName}')" 
                                            class="p-1 bg-blue-600/60 rounded text-white hover:bg-blue-600/80 transition"
                                            title="æ’å…¥åˆ°ç¼–è¾‘å™¨">
                                        <i class="fas fa-edit text-xs"></i>
                                    </button>
                                </div>
                            </div>
                            <div class="image-manager-info">
                                <div class="font-medium text-slate-200 truncate">${imageName}</div>
                                <div class="image-manager-meta">
                                    <span class="image-size">${imageSize}</span>
                                    <span class="text-xs">${new Date(image.created_at).toLocaleDateString()}</span>
                                </div>
                            </div>
                        </div>
                    `;
                });
                
                html += '</div>';
                contentDiv.innerHTML = html;
                
            } catch (error) {
                console.error('åŠ è½½å›¾ç‰‡å¤±è´¥:', error);
                contentDiv.innerHTML = `
                    <div class="text-center py-20 text-slate-700 italic text-sm">
                        åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥
                    </div>
                `;
            }
        }
        
        function insertImageToEditor(url, name) {
            const markdown = `![${name}](${url})`;
            
            // æ£€æŸ¥å½“å‰æ˜¯å¦æœ‰æ‰“å¼€çš„ç¼–è¾‘å™¨
            const editModal = document.getElementById('editModal');
            const addNoteModal = document.getElementById('addNoteModal');
            
            if (!editModal.classList.contains('hidden')) {
                // æ’å…¥åˆ°ç¼–è¾‘æ¨¡æ€æ¡†
                const textarea = document.getElementById('editNoteContent');
                if (textarea) {
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const currentText = textarea.value;
                    
                    textarea.value = currentText.substring(0, start) + markdown + '\n' + currentText.substring(end);
                    textarea.selectionStart = start + markdown.length + 1;
                    textarea.selectionEnd = start + markdown.length + 1;
                    textarea.focus();
                    
                    updateCharCount();
                }
                closeImageManagerModal();
            } else if (!addNoteModal.classList.contains('hidden')) {
                // æ’å…¥åˆ°å¿«é€Ÿæ·»åŠ ç¬”è®°æ¨¡æ€æ¡†
                const textarea = document.getElementById('quickNoteInput');
                if (textarea) {
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const currentText = textarea.value;
                    
                    textarea.value = currentText.substring(0, start) + markdown + '\n' + currentText.substring(end);
                    textarea.selectionStart = start + markdown.length + 1;
                    textarea.selectionEnd = start + markdown.length + 1;
                    textarea.focus();
                }
                closeImageManagerModal();
            } else {
                // æ’å…¥åˆ°ä¸»ç¬”è®°ç¼–è¾‘å™¨
                const textarea = document.getElementById('noteInput');
                if (textarea) {
                    const start = textarea.selectionStart;
                    const end = textarea.selectionEnd;
                    const currentText = textarea.value;
                    
                    textarea.value = currentText.substring(0, start) + markdown + '\n' + currentText.substring(end);
                    textarea.selectionStart = start + markdown.length + 1;
                    textarea.selectionEnd = start + markdown.length + 1;
                    textarea.focus();
                    
                    // æ›´æ–°å­—ç¬¦è®¡æ•°
                    const noteCharCount = document.getElementById('noteCharCount');
                    if (noteCharCount) {
                        noteCharCount.textContent = textarea.value.length;
                    }
                }
                closeImageManagerModal();
            }
            
            showToast('å›¾ç‰‡å·²æ’å…¥åˆ°ç¼–è¾‘å™¨', 'success');
        }

        // ==================== å¯¼èˆªåŠŸèƒ½ ====================
        async function loadNavLinks() {
            try {
                const response = await fetch(`${API_URL}/api/nav/list`, {
                    headers: { 'Authorization': ADMIN_KEY }
                });
                
                if (!response.ok) {
                    throw new Error('è·å–å¯¼èˆªé“¾æ¥å¤±è´¥');
                }
                
                const navLinks = await response.json();
                
                navLinksCache = {};
                navLinks.forEach(link => {
                    navLinksCache[link.id] = link;
                });
                
                const categories = {};
                navLinks.forEach(link => {
                    const category = link.category || 'æœªåˆ†ç±»';
                    if (!categories[category]) {
                        categories[category] = [];
                    }
                    categories[category].push(link);
                });
                
                const navCategoriesDiv = document.getElementById('navCategories');
                if (navLinks.length === 0) {
                    navCategoriesDiv.innerHTML = `
                        <div class="text-center py-20 space-y-4">
                            <div class="text-5xl text-slate-700">ğŸ”—</div>
                            <p class="text-slate-600 italic">æš‚æ— å¯¼èˆªé“¾æ¥ï¼Œç‚¹å‡»"æ·»åŠ é“¾æ¥"å¼€å§‹åˆ›å»º</p>
                        </div>
                    `;
                    document.getElementById('navStats').textContent = '0 ä¸ªé“¾æ¥';
                    return;
                }
                
                let html = '';
                const categoryNames = Object.keys(categories).sort();
                
                categoryNames.forEach(category => {
                    const links = categories[category];
                    html += `
                        <div class="space-y-4">
                            <h3 class="text-lg font-bold text-slate-300 flex items-center gap-2">
                                <span class="category-tag bg-purple-900/30 text-purple-400">${category}</span>
                                <span class="text-sm text-slate-500">(${links.length}ä¸ªé“¾æ¥)</span>
                            </h3>
                            <div class="nav-grid">
                    `;
                    
                    links.forEach(link => {
                        const iconClass = link.icon || 'fas fa-globe';
                        const iconColor = link.icon_color || 'icon-blue';
                        const description = link.description ? `<p class="text-xs text-slate-500 mt-1 line-clamp-2">${link.description}</p>` : '';
                        
                        html += `
                            <div class="nav-link-card glass p-5 rounded-2xl space-y-3 cursor-pointer" onclick="openLinkInNewTab('${link.url}')" title="ç‚¹å‡»è®¿é—®: ${link.url}">
                                <div class="flex items-start justify-between">
                                    <div class="flex items-center gap-3">
                                        <div class="p-2 bg-slate-800/50 rounded-lg">
                                            <i class="${iconClass} ${iconColor} text-lg"></i>
                                        </div>
                                        <div class="flex-1">
                                            <h4 class="font-bold text-slate-200">${link.title}</h4>
                                            ${description}
                                        </div>
                                    </div>
                                    <button onclick="event.stopPropagation(); editNavLink(${link.id})" class="p-2 text-slate-500 hover:text-purple-400 transition" title="ç¼–è¾‘">
                                        <i class="fas fa-edit"></i>
                                    </button>
                                </div>
                                <div class="flex justify-between items-center text-xs text-slate-500">
                                    <span class="truncate font-mono" title="${link.url}">${link.url.replace(/https?:\/\//, '')}</span>
                                    <span>${new Date(link.created_at).toLocaleDateString()}</span>
                                </div>
                            </div>
                        `;
                    });
                    
                    html += `
                            </div>
                        </div>
                    `;
                });
                
                navCategoriesDiv.innerHTML = html;
                
                document.getElementById('navStats').textContent = `${navLinks.length} ä¸ªé“¾æ¥ï¼Œ${categoryNames.length} ä¸ªåˆ†ç±»`;
                
            } catch (error) {
                console.error('åŠ è½½å¯¼èˆªé“¾æ¥å¤±è´¥:', error);
                const navCategoriesDiv = document.getElementById('navCategories');
                navCategoriesDiv.innerHTML = `
                    <div class="text-center py-20 text-slate-700 italic text-sm">
                        åŠ è½½å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥æˆ–é…ç½®
                    </div>
                `;
            }
        }
        
        function openLinkInNewTab(url) {
            window.open(url, '_blank');
        }
        
        function showAddNavLinkModal() {
            document.getElementById('addNavLinkModal').classList.remove('hidden');
            document.getElementById('navLinkTitle').value = '';
            document.getElementById('navLinkUrl').value = '';
            document.getElementById('navLinkCategory').value = 'æ—¥å¸¸æ•ˆç‡';
            document.getElementById('navLinkIcon').value = 'fas fa-globe';
            document.getElementById('navLinkIconColor').value = 'icon-blue';
            document.getElementById('navLinkDescription').value = '';
        }
        
        function closeAddNavLinkModal() {
            document.getElementById('addNavLinkModal').classList.add('hidden');
        }
        
        function setNavCategory(category) {
            document.getElementById('navLinkCategory').value = category;
        }
        
        function setNavIcon(icon, color) {
            document.getElementById('navLinkIcon').value = icon;
            document.getElementById('navLinkIconColor').value = color;
        }
        
        async function saveNavLink() {
            const title = document.getElementById('navLinkTitle').value.trim();
            const url = document.getElementById('navLinkUrl').value.trim();
            const category = document.getElementById('navLinkCategory').value.trim() || 'æœªåˆ†ç±»';
            const icon = document.getElementById('navLinkIcon').value;
            const icon_color = document.getElementById('navLinkIconColor').value;
            const description = document.getElementById('navLinkDescription').value.trim();
            
            if (!title || !url) {
                alert("è¯·å¡«å†™é“¾æ¥æ ‡é¢˜å’Œåœ°å€");
                return;
            }
            
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                alert("é“¾æ¥åœ°å€æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä»¥ http:// æˆ– https:// å¼€å¤´");
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/nav/save`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': ADMIN_KEY 
                    },
                    body: JSON.stringify({
                        title,
                        url,
                        category,
                        icon,
                        icon_color,
                        description
                    })
                });
                
                if (response.ok) {
                    alert("âœ… å¯¼èˆªé“¾æ¥å·²ä¿å­˜");
                    closeAddNavLinkModal();
                    loadNavLinks();
                } else {
                    alert("âŒ ä¿å­˜å¤±è´¥");
                }
            } catch (error) {
                console.error('ä¿å­˜å¯¼èˆªé“¾æ¥å¤±è´¥:', error);
                alert("âŒ ç½‘ç»œè¿æ¥å¤±è´¥");
            }
        }
        
        async function editNavLink(id) {
            const link = navLinksCache[id];
            if (!link) {
                alert("é“¾æ¥ä¸å­˜åœ¨");
                return;
            }
            
            currentEditNavLinkId = id;
            document.getElementById('editNavLinkId').textContent = `#${id}`;
            document.getElementById('editNavLinkTitle').value = link.title;
            document.getElementById('editNavLinkUrl').value = link.url;
            document.getElementById('editNavLinkCategory').value = link.category || 'æœªåˆ†ç±»';
            document.getElementById('editNavLinkIcon').value = link.icon || 'fas fa-globe';
            document.getElementById('editNavLinkIconColor').value = link.icon_color || 'icon-blue';
            document.getElementById('editNavLinkDescription').value = link.description || '';
            
            const iconPreview = document.getElementById('editNavIconPreview');
            iconPreview.innerHTML = `<i class="${link.icon || 'fas fa-globe'} ${link.icon_color || 'icon-blue'} text-2xl"></i>`;
            
            document.getElementById('editNavLinkModal').classList.remove('hidden');
        }
        
        function setEditNavCategory(category) {
            document.getElementById('editNavLinkCategory').value = category;
        }
        
        function setEditNavIcon(icon, color) {
            document.getElementById('editNavLinkIcon').value = icon;
            document.getElementById('editNavLinkIconColor').value = color;
            const iconPreview = document.getElementById('editNavIconPreview');
            iconPreview.innerHTML = `<i class="${icon} ${color} text-2xl"></i>`;
        }
        
        function closeEditNavLinkModal() {
            document.getElementById('editNavLinkModal').classList.add('hidden');
            currentEditNavLinkId = null;
        }
        
        async function updateNavLink() {
            const title = document.getElementById('editNavLinkTitle').value.trim();
            const url = document.getElementById('editNavLinkUrl').value.trim();
            const category = document.getElementById('editNavLinkCategory').value.trim() || 'æœªåˆ†ç±»';
            const icon = document.getElementById('editNavLinkIcon').value;
            const icon_color = document.getElementById('editNavLinkIconColor').value;
            const description = document.getElementById('editNavLinkDescription').value.trim();
            
            if (!title || !url) {
                alert("è¯·å¡«å†™é“¾æ¥æ ‡é¢˜å’Œåœ°å€");
                return;
            }
            
            if (!url.startsWith('http://') && !url.startsWith('https://')) {
                alert("é“¾æ¥åœ°å€æ ¼å¼ä¸æ­£ç¡®ï¼Œè¯·ä»¥ http:// æˆ– https:// å¼€å¤´");
                return;
            }
            
            try {
                const response = await fetch(`${API_URL}/api/nav/save`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': ADMIN_KEY 
                    },
                    body: JSON.stringify({
                        id: currentEditNavLinkId,
                        title,
                        url,
                        category,
                        icon,
                        icon_color,
                        description
                    })
                });
                
                if (response.ok) {
                    alert("âœ… å¯¼èˆªé“¾æ¥å·²æ›´æ–°");
                    closeEditNavLinkModal();
                    loadNavLinks();
                } else {
                    alert("âŒ æ›´æ–°å¤±è´¥");
                }
            } catch (error) {
                console.error('æ›´æ–°å¯¼èˆªé“¾æ¥å¤±è´¥:', error);
                alert("âŒ ç½‘ç»œè¿æ¥å¤±è´¥");
            }
        }
        
        function confirmDeleteNavLink() {
            if (confirm("ç¡®å®šè¦åˆ é™¤è¿™ä¸ªå¯¼èˆªé“¾æ¥å—ï¼Ÿæ­¤æ“ä½œä¸å¯æ’¤é”€ã€‚")) {
                deleteNavLink(currentEditNavLinkId);
            }
        }
        
        async function deleteNavLink(id) {
            try {
                const response = await fetch(`${API_URL}/api/nav/delete`, {
                    method: 'POST',
                    headers: { 
                        'Content-Type': 'application/json',
                        'Authorization': ADMIN_KEY 
                    },
                    body: JSON.stringify({ id })
                });
                
                if (response.ok) {
                    alert("âœ… å¯¼èˆªé“¾æ¥å·²åˆ é™¤");
                    closeEditNavLinkModal();
                    loadNavLinks();
                } else {
                    alert("âŒ åˆ é™¤å¤±è´¥");
                }
            } catch (error) {
                console.error('åˆ é™¤å¯¼èˆªé“¾æ¥å¤±è´¥:', error);
                alert("âŒ ç½‘ç»œè¿æ¥å¤±è´¥");
            }
        }
        
        async function exportNavLinks() {
            try {
                const response = await fetch(`${API_URL}/api/nav/list`, {
                    headers: { 'Authorization': ADMIN_KEY }
                });
                
                if (!response.ok) {
                    throw new Error('è·å–å¯¼èˆªé“¾æ¥å¤±è´¥');
                }
                
                const navLinks = await response.json();
                
                const exportData = {
                    export_date: new Date().toISOString(),
                    total_links: navLinks.length,
                    categories: {},
                    links: navLinks
                };
                
                navLinks.forEach(link => {
                    const category = link.category || 'æœªåˆ†ç±»';
                    if (!exportData.categories[category]) {
                        exportData.categories[category] = [];
                    }
                    exportData.categories[category].push(link.title);
                });
                
                const blob = new Blob([JSON.stringify(exportData, null, 2)], { type: 'application/json' });
                const url = URL.createObjectURL(blob);
                const a = document.createElement('a');
                a.href = url;
                a.download = `CloudNotes_Nav_Export_${new Date().toISOString().split('T')[0]}.json`;
                a.click();
                URL.revokeObjectURL(url);
                
            } catch (error) {
                console.error('å¯¼å‡ºå¯¼èˆªé“¾æ¥å¤±è´¥:', error);
                alert("âŒ å¯¼å‡ºå¤±è´¥");
            }
        }

        // ==================== ç¬”è®°åŠŸèƒ½ ====================
        function showAddNoteModal() {
            document.getElementById('addNoteModal').classList.remove('hidden');
            document.getElementById('quickMainPw').value = '';
            document.getElementById('quickNoteInput').value = '';
            document.getElementById('quickNoteCharCount').textContent = '0';
            
            const quickNoteInput = document.getElementById('quickNoteInput');
            const quickNoteCharCount = document.getElementById('quickNoteCharCount');
            quickNoteInput.addEventListener('input', function() {
                quickNoteCharCount.textContent = this.value.length;
            });
        }
        
        function closeAddNoteModal() {
            document.getElementById('addNoteModal').classList.add('hidden');
        }
        
        async function quickSaveNote() {
            const text = document.getElementById('quickNoteInput').value;
            const pw = document.getElementById('quickMainPw').value;
            
            if (!text || !pw) {
                alert("è¯·å¡«å†™å†…å®¹å’Œå¯†ç ");
                return;
            }
            
            try {
                const cipher = await encrypt(text, pw);
                
                const res = await fetch(`${API_URL}/api/save`, {
                    method: 'POST', 
                    headers: { 
                        'Content-Type': 'application/json', 
                        'Authorization': ADMIN_KEY 
                    },
                    body: JSON.stringify({ content: cipher })
                });
                
                if (res.ok) { 
                    alert("âœ… ç¬”è®°å·²å­˜å…¥å®‰å…¨åº“"); 
                    closeAddNoteModal();
                    if (currentView === 'notes') {
                        loadNotesList();
                    }
                } else {
                    alert("âŒ ä¿å­˜å¤±è´¥");
                }
            } catch (e) { 
                alert("âŒ ç½‘ç»œè¿æ¥å¤±è´¥"); 
            }
        }
        
        // ==================== æ ¸å¿ƒæ”¹è¿›éƒ¨åˆ† ====================
        
        // Base64 ç¼–ç è¾…åŠ©å‡½æ•°
        function base64Encode(str) {
            try {
                return btoa(unescape(encodeURIComponent(str)));
            } catch (e) {
                console.error('Base64ç¼–ç å¤±è´¥:', e);
                return '';
            }
        }
        
        // Base64 è§£ç è¾…åŠ©å‡½æ•°
        function base64Decode(str) {
            try {
                return decodeURIComponent(escape(atob(str)));
            } catch (e) {
                console.error('Base64è§£ç å¤±è´¥:', e);
                return '';
            }
        }
        
        // ä» data å±æ€§å¯¼å‡ºçš„å‡½æ•°
        function exportFromData(button) {
            const id = button.getAttribute('data-note-id');
            const base64Content = button.getAttribute('data-note-content-base64');
            
            if (!base64Content) {
                const note = notesCache[id];
                if (note && note.clearText) {
                    doExport(note.clearText, parseInt(id));
                } else {
                    alert('æ— æ³•è·å–ç¬”è®°å†…å®¹');
                }
                return;
            }
            
            try {
                const text = base64Decode(base64Content);
                if (text) {
                    doExport(text, parseInt(id));
                } else {
                    throw new Error('è§£ç å¤±è´¥');
                }
            } catch (e) {
                console.error('å¯¼å‡ºå¤±è´¥:', e);
                alert('å¯¼å‡ºå¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }
        
        // ä» data å±æ€§ç¼–è¾‘çš„å‡½æ•°
        function editFromData(button) {
            const id = button.getAttribute('data-note-id');
            const base64Content = button.getAttribute('data-note-content-base64');
            
            if (!base64Content) {
                const note = notesCache[id];
                if (note && note.clearText) {
                    openEdit(parseInt(id), note.clearText);
                } else {
                    alert('æ— æ³•è·å–ç¬”è®°å†…å®¹');
                }
                return;
            }
            
            try {
                const text = base64Decode(base64Content);
                if (text) {
                    openEdit(parseInt(id), text);
                } else {
                    throw new Error('è§£ç å¤±è´¥');
                }
            } catch (e) {
                console.error('ç¼–è¾‘å¤±è´¥:', e);
                alert('ç¼–è¾‘å¤±è´¥ï¼Œè¯·é‡è¯•');
            }
        }
        
        // åŠ è½½ç¬”è®°åˆ—è¡¨å‡½æ•°
        async function loadNotesList() {
            const pw = document.getElementById('mainPw').value; 
            if (!pw) return alert("è¯·è¾“å…¥å¯†ç è§£å¯†");
            
            const listDiv = document.getElementById('notesList');
            listDiv.innerHTML = '<div class="text-center py-12 text-slate-600 italic text-sm">åŠ è½½ä¸­...</div>';
            
            try {
                const res = await fetch(`${API_URL}/api/list`, { headers: { 'Authorization': ADMIN_KEY } });
                const notes = await res.json(); 
                listDiv.innerHTML = "";
                
                if (notes.length === 0) {
                    listDiv.innerHTML = '<div class="text-center py-20 text-slate-700 italic text-sm">æš‚æ— æ•°æ®</div>';
                    return;
                }
                
                notesCache = {};
                
                for (let n of notes) {
                    const clearText = await decrypt(n.content, pw);
                    if (!clearText) {
                        continue;
                    }
                    
                    notesCache[n.id] = {
                        id: n.id,
                        clearText: clearText,
                        created_at: n.created_at
                    };
                    
                    const isMarkdown = clearText.includes('# ') || clearText.includes('## ') || clearText.includes('```') || 
                                       clearText.includes('**') || clearText.includes('- ') || clearText.includes('> ');
                    
                    const card = document.createElement('div');
                    card.className = "note-card glass p-6 rounded-3xl space-y-4 border border-white/5 shadow-lg group";
                    
                    let previewContent = clearText;
                    let showFullButton = false;
                    
                    if (clearText.length > 300) {
                        previewContent = clearText.substring(0, 300) + '...';
                        showFullButton = true;
                    }
                    
                    const renderedContent = isMarkdown ? marked.parse(previewContent) : 
                                            `<div class="whitespace-pre-wrap">${previewContent.replace(/\n/g, '<br>')}</div>`;
                    
                    const base64Content = base64Encode(clearText);
                    
                    card.innerHTML = `
                        <div class="flex justify-between items-center mb-2">
                            <span class="text-[9px] font-black text-slate-500 tracking-widest uppercase italic">
                                ç´¢å¼•ç¼–å· #${n.id}
                            </span>
                            
                            <div class="flex items-center gap-4">
                                ${showFullButton ? `
                                <button onclick="toggleNoteContent(${n.id})" 
                                        class="toggle-btn flex items-center gap-1 px-2 py-1 text-xs text-blue-400 hover:text-blue-300 hover:bg-blue-900/20 rounded-lg transition"
                                        id="topToggle-${n.id}">
                                    <i class="fas fa-chevron-down text-[10px]"></i>
                                    <span>æ˜¾ç¤ºå…¨éƒ¨å†…å®¹</span>
                                </button>
                                ` : ''}
                                
                                <span class="text-[9px] font-black text-slate-500 tracking-widest uppercase italic">
                                    ${new Date(n.created_at).toLocaleString()}
                                </span>
                            </div>
                        </div>
                        
                        <div class="markdown-preview text-slate-300 text-sm leading-relaxed" id="noteContent-${n.id}">
                            ${renderedContent}
                            ${showFullButton ? `
                            <div class="text-center mt-4">
                                <button onclick="toggleNoteContent(${n.id})" 
                                        class="toggle-btn flex items-center justify-center gap-1 mx-auto px-4 py-2 text-xs text-blue-400 hover:text-blue-300 hover:bg-blue-900/20 rounded-lg transition"
                                        id="bottomToggle-${n.id}">
                                    <i class="fas fa-chevron-down text-[10px]"></i>
                                    <span>æ˜¾ç¤ºå…¨éƒ¨å†…å®¹</span>
                                </button>
                            </div>
                            ` : ''}
                        </div>
                        
                        <div class="pt-4 border-t border-white/5 flex flex-wrap gap-4 items-center">
                            <button onclick="doShareCopy(event, '${n.content.replace(/'/g, "\\'")}')" class="share-btn text-xs font-black text-blue-400 uppercase tracking-widest hover:text-blue-300 transition flex items-center gap-1">
                                <i class="fas fa-share"></i>
                                <span>ç”Ÿæˆåˆ†äº«</span>
                            </button>
                            <button data-note-id="${n.id}" data-note-content-base64="${base64Content}" onclick="exportFromData(this)" class="text-xs font-black text-emerald-500 uppercase tracking-widest hover:text-emerald-400 transition flex items-center gap-1">
                                <i class="fas fa-download"></i>
                                <span>å¯¼å‡ºå¤‡ä»½</span>
                            </button>
                            <button data-note-id="${n.id}" data-note-content-base64="${base64Content}" onclick="editFromData(this)" class="text-xs font-black text-amber-500 uppercase tracking-widest hover:text-amber-400 transition flex items-center gap-1">
                                <i class="fas fa-edit"></i>
                                <span>ç¼–è¾‘</span>
                            </button>
                            <button onclick="doDelete(${n.id})" class="text-xs font-black text-rose-500 uppercase tracking-widest ml-auto opacity-40 group-hover:opacity-100 transition flex items-center gap-1">
                                <i class="fas fa-trash"></i>
                                <span>åˆ é™¤</span>
                            </button>
                        </div>
                    `;
                    listDiv.appendChild(card);
                }
                
                setTimeout(() => {
                    hljs.highlightAll();
                }, 100);
            } catch (e) { 
                console.error('åŠ è½½åˆ—è¡¨å¤±è´¥:', e);
                listDiv.innerHTML = '<div class="text-center py-20 text-slate-700 italic text-sm">æ‹‰å–å¤±è´¥ï¼Œè¯·æ£€æŸ¥ç½‘ç»œè¿æ¥</div>';
            }
        }

        // ==================== é€šç”¨åŠŸèƒ½ ====================
        function configUrl() {
            document.getElementById('settingsModal').classList.remove('hidden');
            document.getElementById('setApi').value = API_URL;
            document.getElementById('setKey').value = ADMIN_KEY;
        }
        
        function closeSettings() { 
            document.getElementById('settingsModal').classList.add('hidden'); 
        }
        
        function saveSettings() {
            let apiUrl = document.getElementById('setApi').value.trim();
            apiUrl = apiUrl.replace(/\/+$/, '');
            
            localStorage.setItem('cf_notes_api', apiUrl);
            localStorage.setItem('cf_notes_key', document.getElementById('setKey').value);
            
            location.reload();
        }

        function showMarkdownHelp() {
            const helpContent = `# Markdown è¯­æ³•é€ŸæŸ¥

## æ ‡é¢˜
\`# ä¸€çº§æ ‡é¢˜\`
\`## äºŒçº§æ ‡é¢˜\`
\`### ä¸‰çº§æ ‡é¢˜\`

## æ–‡æœ¬æ ·å¼
- **ç²—ä½“**: \`**ç²—ä½“æ–‡æœ¬**\`
- *æ–œä½“*: \`*æ–œä½“æ–‡æœ¬*\`
- ~~åˆ é™¤çº¿~~: \`~~åˆ é™¤æ–‡æœ¬~~\`
- \`è¡Œå†…ä»£ç \`: \`\` ä»£ç  \`\`

## åˆ—è¡¨
- æ— åºåˆ—è¡¨: \`- é¡¹ç›®\`
- æœ‰åºåˆ—è¡¨: \`1. é¡¹ç›®\`

## é“¾æ¥ä¸å›¾ç‰‡
- [é“¾æ¥](https://example.com): \`[é“¾æ¥æ–‡æœ¬](URL)\`
- ![å›¾ç‰‡](https://example.com/image.jpg): \`![æ›¿ä»£æ–‡æœ¬](å›¾ç‰‡URL)\`

## ä»£ç å—
\`\`\`javascript
// JavaScript ä»£ç 
console.log('Hello');
\`\`\`

## å¼•ç”¨
> å¼•ç”¨å†…å®¹: \`> å¼•ç”¨æ–‡æœ¬\`

## è¡¨æ ¼
| è¡¨å¤´ | è¡¨å¤´ |
|------|------|
| å†…å®¹ | å†…å®¹ |

## åˆ†å‰²çº¿
\`---\` æˆ– \`***\`

## ä»»åŠ¡åˆ—è¡¨
- [ ] æœªå®Œæˆä»»åŠ¡
- [x] å·²å®Œæˆä»»åŠ¡

## å›¾ç‰‡ä¸Šä¼ 
1. ç‚¹å‡»"ä¸Šä¼ å›¾ç‰‡"æŒ‰é’®
2. é€‰æ‹©æˆ–æ‹–æ”¾å›¾ç‰‡æ–‡ä»¶
3. ä¸Šä¼ åå¤åˆ¶Markdowné“¾æ¥
4. ç²˜è´´åˆ°ç¬”è®°ç¼–è¾‘å™¨ä¸­`;

            alert(helpContent);
        }

        // ==================== ç¼–è¾‘æ¨¡å¼åŠŸèƒ½ ====================
        function switchTab(tabName) {
            const editTab = document.getElementById('editTab');
            const previewTab = document.getElementById('previewTab');
            const editTabBtn = document.getElementById('editTabBtn');
            const previewTabBtn = document.getElementById('previewTabBtn');
            const editContent = document.getElementById('editNoteContent');
            
            if (tabName === 'edit') {
                editTab.classList.remove('hidden');
                previewTab.classList.add('hidden');
                editTabBtn.classList.add('active');
                previewTabBtn.classList.remove('active');
            } else {
                editTab.classList.add('hidden');
                previewTab.classList.remove('hidden');
                editTabBtn.classList.remove('active');
                previewTabBtn.classList.add('active');
                
                const previewDiv = document.getElementById('markdownPreview');
                const markdownContent = editContent.value || '';
                
                previewDiv.innerHTML = marked.parse(markdownContent);
                
                setTimeout(() => {
                    hljs.highlightAll();
                    
                    previewDiv.querySelectorAll('pre code').forEach((block) => {
                        if (!block.classList.contains('hljs')) {
                            hljs.highlightElement(block);
                        }
                    });
                }, 100);
            }
        }

        function insertMarkdown(syntax, placeholder) {
            const textarea = document.getElementById('editNoteContent');
            const start = textarea.selectionStart;
            const end = textarea.selectionEnd;
            const selectedText = textarea.value.substring(start, end);
            
            if (selectedText) {
                let newText;
                if (syntax === '**') {
                    newText = `**${selectedText}**`;
                } else if (syntax === '*') {
                    newText = `*${selectedText}*`;
                } else if (syntax === '~~') {
                    newText = `~~${selectedText}~~`;
                } else if (syntax === '[é“¾æ¥æ–‡æœ¬](https://)') {
                    newText = `[${selectedText}](https://)`;
                } else if (syntax === '![æ›¿ä»£æ–‡æœ¬](https://)') {
                    newText = `![${selectedText}](https://)`;
                } else {
                    newText = syntax + selectedText;
                }
                
                textarea.value = textarea.value.substring(0, start) + newText + textarea.value.substring(end);
                
                if (syntax === '**' || syntax === '*' || syntax === '~~') {
                    textarea.selectionStart = start + syntax.length;
                    textarea.selectionEnd = end + syntax.length;
                } else if (syntax === '[é“¾æ¥æ–‡æœ¬](https://)') {
                    textarea.selectionStart = start + 1;
                    textarea.selectionEnd = end + 1;
                } else if (syntax === '![æ›¿ä»£æ–‡æœ¬](https://)') {
                    textarea.selectionStart = start + 2;
                    textarea.selectionEnd = end + 2;
                } else {
                    textarea.selectionStart = start + syntax.length;
                    textarea.selectionEnd = start + syntax.length + placeholder.length;
                }
            } else {
                let placeholderText;
                if (syntax === '```javascript\n\n```') {
                    placeholderText = '```javascript\n' + placeholder + '\n```';
                } else if (syntax === '**') {
                    placeholderText = `**${placeholder}**`;
                } else if (syntax === '*') {
                    placeholderText = `*${placeholder}*`;
                } else if (syntax === '~~') {
                    placeholderText = `~~${placeholder}~~`;
                } else if (syntax === '[é“¾æ¥æ–‡æœ¬](https://)') {
                    placeholderText = `[é“¾æ¥æ–‡æœ¬](https://)`;
                } else if (syntax === '![æ›¿ä»£æ–‡æœ¬](https://)') {
                    placeholderText = `![æ›¿ä»£æ–‡æœ¬](https://)`;
                } else {
                    placeholderText = syntax + placeholder;
                }
                
                textarea.value = textarea.value.substring(0, start) + placeholderText + textarea.value.substring(end);
                
                if (syntax === '```javascript\n\n```') {
                    textarea.selectionStart = start + '```javascript\n'.length;
                    textarea.selectionEnd = start + '```javascript\n'.length + placeholder.length;
                } else if (syntax === '**') {
                    textarea.selectionStart = start + 2;
                    textarea.selectionEnd = start + 2 + placeholder.length;
                } else if (syntax === '*') {
                    textarea.selectionStart = start + 1;
                    textarea.selectionEnd = start + 1 + placeholder.length;
                } else if (syntax === '~~') {
                    textarea.selectionStart = start + 2;
                    textarea.selectionEnd = start + 2 + placeholder.length;
                } else if (syntax === '[é“¾æ¥æ–‡æœ¬](https://)') {
                    textarea.selectionStart = start + 1;
                    textarea.selectionEnd = start + 5;
                } else if (syntax === '![æ›¿ä»£æ–‡æœ¬](https://)') {
                    textarea.selectionStart = start + 2;
                    textarea.selectionEnd = start + 6;
                } else {
                    textarea.selectionStart = start + syntax.length;
                    textarea.selectionEnd = start + syntax.length + placeholder.length;
                }
            }
            
            textarea.focus();
            updateCharCount();
        }

        function updateCharCount() {
            const textarea = document.getElementById('editNoteContent');
            const charCount = document.getElementById('editCharCount');
            if (textarea && charCount) {
                charCount.textContent = textarea.value.length;
            }
        }

        async function doSave(content, id = null) {
            const text = content || document.getElementById('noteInput').value;
            const pw = document.getElementById('mainPw').value;
            
            if (!text || !pw) {
                alert("è¯·å¡«å†™å†…å®¹å’Œå¯†ç ");
                return null;
            }
            
            try {
                const cipher = await encrypt(text, pw);
                
                const body = { content: cipher };
                
                if (id !== null) {
                    body.id = id;
                }
                
                const res = await fetch(`${API_URL}/api/save`, {
                    method: 'POST', 
                    headers: { 
                        'Content-Type': 'application/json', 
                        'Authorization': ADMIN_KEY 
                    },
                    body: JSON.stringify(body)
                });
                
                if (res.ok) { 
                    if (id === null) {
                        alert("âœ… å·²å­˜å…¥å®‰å…¨åº“"); 
                        document.getElementById('noteInput').value = ""; 
                        document.getElementById('noteCharCount').textContent = "0";
                    } else {
                        alert("âœ… ç¬”è®°å·²æ›´æ–°");
                    }
                    loadNotesList();
                    return true;
                } else {
                    alert("âŒ ä¿å­˜å¤±è´¥");
                    return false;
                }
            } catch (e) { 
                alert("âŒ ç½‘ç»œè¿æ¥å¤±è´¥"); 
                return false;
            }
        }

        function toggleNoteContent(id) {
            const contentDiv = document.getElementById(`noteContent-${id}`);
            const topToggleBtn = document.getElementById(`topToggle-${id}`);
            const bottomToggleBtn = document.getElementById(`bottomToggle-${id}`);
            const note = notesCache[id];
            
            if (!note) {
                console.error('æœªæ‰¾åˆ°ç¬”è®°ç¼“å­˜:', id);
                return;
            }
            
            const currentContent = contentDiv.innerHTML;
            const showFullText = currentContent.includes('æ˜¾ç¤ºå…¨éƒ¨å†…å®¹');
            
            const isMarkdown = note.clearText.includes('# ') || note.clearText.includes('## ') || 
                               note.clearText.includes('```') || note.clearText.includes('**') ||
                               note.clearText.includes('- ') || note.clearText.includes('> ');
            
            if (showFullText) {
                const renderedContent = isMarkdown ? marked.parse(note.clearText) : 
                                        `<div class="whitespace-pre-wrap">${note.clearText.replace(/\n/g, '<br>')}</div>`;
                contentDiv.innerHTML = renderedContent + 
                    `<div class="text-center mt-4">
                        <button onclick="toggleNoteContent(${id})" 
                                class="toggle-btn expanded flex items-center justify-center gap-1 mx-auto px-4 py-2 text-xs text-blue-400 hover:text-blue-300 hover:bg-blue-900/20 rounded-lg transition"
                                id="bottomToggle-${id}">
                            <i class="fas fa-chevron-up text-[10px]"></i>
                            <span>æ”¶èµ·</span>
                        </button>
                    </div>`;
                
                if (topToggleBtn) {
                    topToggleBtn.classList.add('expanded');
                    topToggleBtn.innerHTML = `
                        <i class="fas fa-chevron-up text-[10px]"></i>
                        <span>æ”¶èµ·</span>
                    `;
                }
                
                setTimeout(() => {
                    hljs.highlightAll();
                }, 100);
            } else {
                let previewContent = note.clearText;
                if (note.clearText.length > 300) {
                    previewContent = note.clearText.substring(0, 300) + '...';
                }
                
                const renderedContent = isMarkdown ? marked.parse(previewContent) : 
                                        `<div class="whitespace-pre-wrap">${previewContent.replace(/\n/g, '<br>')}</div>`;
                contentDiv.innerHTML = renderedContent + 
                    `<div class="text-center mt-4">
                        <button onclick="toggleNoteContent(${id})" 
                                class="toggle-btn flex items-center justify-center gap-1 mx-auto px-4 py-2 text-xs text-blue-400 hover:text-blue-300 hover:bg-blue-900/20 rounded-lg transition"
                                id="bottomToggle-${id}">
                            <i class="fas fa-chevron-down text-[10px]"></i>
                            <span>æ˜¾ç¤ºå…¨éƒ¨å†…å®¹</span>
                        </button>
                    </div>`;
                
                if (topToggleBtn) {
                    topToggleBtn.classList.remove('expanded');
                    topToggleBtn.innerHTML = `
                        <i class="fas fa-chevron-down text-[10px]"></i>
                        <span>æ˜¾ç¤ºå…¨éƒ¨å†…å®¹</span>
                    `;
                }
            }
        }

        // ==================== ç¼–è¾‘åŠŸèƒ½ ====================
        function openEdit(id, content) {
            currentEditId = id;
            document.getElementById('editNoteId').textContent = `#${id}`;
            
            const textarea = document.getElementById('editNoteContent');
            textarea.value = content;
            
            updateCharCount();
            
            textarea.addEventListener('input', updateCharCount);
            
            textarea.addEventListener('input', function() {
                if (!document.getElementById('previewTab').classList.contains('hidden')) {
                    switchTab('preview');
                }
            });
            
            switchTab('edit');
            
            document.getElementById('editModal').classList.remove('hidden');
            
            setTimeout(() => {
                textarea.focus();
            }, 100);
        }
        
        function closeEdit() {
            document.getElementById('editModal').classList.add('hidden');
            currentEditId = null;
        }
        
        async function saveEdit() {
            const newContent = document.getElementById('editNoteContent').value;
            
            if (!newContent.trim()) {
                alert("ç¬”è®°å†…å®¹ä¸èƒ½ä¸ºç©º");
                return;
            }
            
            const success = await doSave(newContent, currentEditId);
            
            if (success) {
                closeEdit();
            }
        }

        // ==================== åˆ†äº«åŠŸèƒ½ ====================
        async function doShareCopy(event, cipher) {
            const pid = Math.random().toString(36).substring(2, 12);
            
            const button = event.target.closest('button');
            const originalText = button.innerHTML;
            button.innerHTML = '<i class="fas fa-spinner fa-spin"></i> ç”Ÿæˆä¸­...';
            button.disabled = true;
            
            try {
                await fetch(`${API_URL}/api/save`, {
                    method: 'POST', 
                    headers: { 
                        'Content-Type': 'application/json', 
                        'Authorization': ADMIN_KEY 
                    },
                    body: JSON.stringify({ 
                        content: cipher, 
                        public_id: pid, 
                        is_share: 1 
                    })
                });
                
                const fullUrl = `${window.location.origin}${window.location.pathname}?share=${pid}&cfg=${btoa(API_URL)}`;
                
                try {
                    await navigator.clipboard.writeText(fullUrl);
                    
                    button.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                    button.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                    button.style.color = 'white';
                    
                    setTimeout(() => {
                        button.innerHTML = originalText;
                        button.disabled = false;
                        button.style.background = '';
                        button.style.color = '';
                    }, 3000);
                    
                    showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                    
                } catch (clipboardError) {
                    console.error('Clipboard API å¤±è´¥:', clipboardError);
                    
                    const textarea = document.createElement('textarea');
                    textarea.value = fullUrl;
                    document.body.appendChild(textarea);
                    textarea.select();
                    
                    try {
                        const success = document.execCommand('copy');
                        if (success) {
                            button.innerHTML = '<i class="fas fa-check"></i> å·²å¤åˆ¶';
                            button.style.background = 'linear-gradient(135deg, #10b981, #059669)';
                            button.style.color = 'white';
                            
                            setTimeout(() => {
                                button.innerHTML = originalText;
                                button.disabled = false;
                                button.style.background = '';
                                button.style.color = '';
                            }, 3000);
                            
                            showToast('é“¾æ¥å·²å¤åˆ¶åˆ°å‰ªè´´æ¿ï¼', 'success');
                        } else {
                            prompt("âœ… é˜…åå³ç„šåŠ å¯†é“¾æ¥å·²ç”Ÿæˆï¼ˆè¯·æ‰‹åŠ¨å¤åˆ¶ï¼‰ï¼š", fullUrl);
                            button.innerHTML = originalText;
                            button.disabled = false;
                        }
                    } catch (execError) {
                        console.error('execCommand å¤±è´¥:', execError);
                        prompt("âœ… é˜…åå³ç„šåŠ å¯†é“¾æ¥å·²ç”Ÿæˆï¼ˆè¯·æ‰‹åŠ¨å¤åˆ¶ï¼‰ï¼š", fullUrl);
                        button.innerHTML = originalText;
                        button.disabled = false;
                    } finally {
                        document.body.removeChild(textarea);
                    }
                }
            } catch (e) { 
                console.error('ç”Ÿæˆåˆ†äº«é“¾æ¥å¤±è´¥:', e);
                
                button.innerHTML = '<i class="fas fa-exclamation-triangle"></i> å¤±è´¥';
                button.style.background = 'linear-gradient(135deg, #ef4444, #dc2626)';
                button.style.color = 'white';
                
                setTimeout(() => {
                    button.innerHTML = originalText;
                    button.disabled = false;
                    button.style.background = '';
                    button.style.color = '';
                }, 3000);
                
                showToast('åˆ†äº«å¤±è´¥ï¼Œè¯·é‡è¯•', 'error');
            }
        }

        // ==================== Toast é€šçŸ¥å‡½æ•° ====================
        function showToast(message, type = 'info') {
            const existingToast = document.getElementById('customToast');
            if (existingToast) {
                existingToast.remove();
            }
            
            const toast = document.createElement('div');
            toast.id = 'customToast';
            toast.className = 'toast ' + type;
            toast.innerHTML = `
                <i class="fas ${type === 'success' ? 'fa-check-circle' : type === 'error' ? 'fa-exclamation-circle' : 'fa-info-circle'}"></i>
                <span>${message}</span>
            `;
            
            document.getElementById('toastContainer').appendChild(toast);
            
            setTimeout(() => {
                toast.classList.add('show');
            }, 10);
            
            setTimeout(() => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            }, 3000);
            
            toast.addEventListener('click', () => {
                toast.classList.remove('show');
                setTimeout(() => {
                    if (toast.parentNode) {
                        toast.parentNode.removeChild(toast);
                    }
                }, 300);
            });
        }

        function doExport(text, id) {
            const date = new Date().toISOString().split('T')[0];
            const blob = new Blob([text], { type: 'text/plain;charset=utf-8' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a'); 
            a.href = url; 
            a.download = `CloudNote_${id}_${date}.md`; 
            a.click();
        }

        async function doDelete(id) {
            if (!confirm("ç¡®å®šè¦ç‰©ç†æŠ¹é™¤è¿™æ¡è®°å½•å—ï¼Ÿ")) return;
            await fetch(`${API_URL}/api/delete`, {
                method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': ADMIN_KEY },
                body: JSON.stringify({ id: id })
            });
            loadNotesList();
        }

        async function doAI() {
            const text = document.getElementById('noteInput').value; 
            if (!text) return alert("ç¬”è®°ä¸ºç©º");
            const btn = event.target; 
            btn.innerText = "æ€è€ƒä¸­..."; 
            btn.disabled = true;
            try {
                const res = await fetch(`${API_URL}/api/ai-sum`, {
                    method: 'POST', headers: { 'Content-Type': 'application/json', 'Authorization': ADMIN_KEY },
                    body: JSON.stringify({ text: text.substring(0, 1000) })
                });
                const data = await res.json();
                document.getElementById('noteInput').value += `\n\n--- âœ¨ AI æ€»ç»“ ---\n\n${data.summary}`;
                document.getElementById('noteCharCount').textContent = document.getElementById('noteInput').value.length;
            } finally { 
                btn.innerText = "âœ¨ AI æ™ºèƒ½æ€»ç»“"; 
                btn.disabled = false; 
            }
        }

        // ==================== é˜…åå³ç„šåŠŸèƒ½ ====================
        async function doUnlockShare() {
            const pw = document.getElementById('sharePw').value; 
            const resDiv = document.getElementById('shareResult');
            const unlockBtn = document.getElementById('unlockBtn');
            const burnTimerDiv = document.getElementById('burnTimer');
            const charsBurnedSpan = document.getElementById('charsBurned');
            const totalCharsSpan = document.getElementById('totalChars');
            const burnPercentageSpan = document.getElementById('burnPercentage');
            const burnProgressBar = document.getElementById('burnProgressBar');
            const burnNowBtn = document.getElementById('burnNowBtn');
            const burnSpeedSpan = document.getElementById('burnSpeed');
            
            if (!pw) {
                alert("è¯·è¾“å…¥è§£å¯†å¯†ç ");
                return;
            }
            
            try {
                unlockBtn.innerText = "è§£å¯†ä¸­...";
                unlockBtn.disabled = true;
                
                const res = await fetch(`${API_URL}/api/share/${shareId}`);
                if (!res.ok) {
                    alert("é“¾æ¥å·²å¤±æ•ˆæˆ–å†…å®¹å·²è¢«ç„šæ¯");
                    return;
                }
                
                const data = await res.json(); 
                const clearText = await decrypt(data.content, pw);
                
                if (clearText) { 
                    originalContent = clearText;
                    
                    const burningContentDiv = document.getElementById('burningContent');
                    burningContentDiv.innerHTML = marked.parse(clearText);
                    
                    hljs.highlightAll();
                    
                    resDiv.classList.remove('hidden'); 
                    
                    unlockBtn.innerText = "æ•°æ®å·²è§£å¯†";
                    unlockBtn.classList.remove('share-gradient');
                    unlockBtn.classList.add('bg-gray-600', 'cursor-not-allowed');
                    
                    prepareSequentialBurnAnimation();
                    
                    totalChars = burningChars.length;
                    charsBurnedSpan.textContent = "0";
                    totalCharsSpan.textContent = totalChars;
                    burnPercentageSpan.textContent = "0%";
                    burnProgressBar.style.width = "0%";
                    burnSpeedSpan.textContent = "é€Ÿåº¦: ä¸­";
                    
                    isBurningActive = false;
                    burnTimeLeft = 10;
                    currentCharIndex = 0;
                    
                    burnTimerDiv.classList.remove('hidden');
                    startBurnCountdown();
                    
                    burnNowBtn.disabled = false;
                    burnNowBtn.innerHTML = `<i class="fas fa-fire"></i><span>ç«‹å³ç„šæ¯</span>`;
                    
                } else {
                    alert("å¯†ç é”™è¯¯");
                    unlockBtn.innerText = "è§£å¯†å¹¶é”€æ¯";
                    unlockBtn.disabled = false;
                }
            } catch (e) { 
                console.error("è§£å¯†å¤±è´¥:", e);
                alert("ç½‘ç»œå¼‚å¸¸æˆ–è§£å¯†å¤±è´¥");
                unlockBtn.innerText = "è§£å¯†å¹¶é”€æ¯";
                unlockBtn.disabled = false;
            }
        }

        function prepareSequentialBurnAnimation() {
            const contentDiv = document.getElementById('burningContent');
            const textNodes = [];
            
            burningChars = [];
            
            function getTextNodes(node) {
                if (node.nodeType === 3) {
                    if (node.textContent.trim()) {
                        textNodes.push(node);
                    }
                } else {
                    for (let child of node.childNodes) {
                        getTextNodes(child);
                    }
                }
            }
            
            getTextNodes(contentDiv);
            
            textNodes.forEach(node => {
                const text = node.textContent;
                const parent = node.parentNode;
                
                if (parent && text.trim()) {
                    const chars = text.split('');
                    const charSpans = chars.map((char, index) => {
                        const span = document.createElement('span');
                        span.className = 'burning-char';
                        span.textContent = char;
                        span.dataset.charIndex = burningChars.length + index;
                        return span;
                    });
                    
                    const wrapper = document.createElement('span');
                    wrapper.className = 'burning-text';
                    charSpans.forEach(span => wrapper.appendChild(span));
                    
                    parent.replaceChild(wrapper, node);
                    
                    charSpans.forEach(span => burningChars.push(span));
                }
            });
            
            console.log(`å‡†å¤‡ç„šæ¯ ${burningChars.length} ä¸ªå­—ç¬¦ï¼ˆé¡ºåºç„šæ¯ï¼‰`);
        }

        function startBurnCountdown() {
            if (burnCountdownInterval) {
                clearInterval(burnCountdownInterval);
            }
            
            burnTimeLeft = 10;
            const timeLeftSpan = document.getElementById('timeLeft');
            const burnTimerDiv = document.getElementById('burnTimer');
            
            burnCountdownInterval = setInterval(() => {
                burnTimeLeft--;
                timeLeftSpan.textContent = burnTimeLeft;
                
                if (burnTimeLeft <= 0) {
                    clearInterval(burnCountdownInterval);
                    burnTimerDiv.classList.add('hidden');
                    startSequentialBurnAnimation();
                }
            }, 1000);
        }

        function startSequentialBurnAnimation() {
            if (isBurningActive || burningChars.length === 0) return;
            
            isBurningActive = true;
            const burnNowBtn = document.getElementById('burnNowBtn');
            burnNowBtn.disabled = true;
            burnNowBtn.innerHTML = `<i class="fas fa-fire animate-spin"></i><span>ç„šæ¯ä¸­...</span>`;
            
            const burnTimerDiv = document.getElementById('burnTimer');
            burnTimerDiv.classList.add('hidden');
            
            const charsBurnedSpan = document.getElementById('charsBurned');
            const totalCharsSpan = document.getElementById('totalChars');
            const burnPercentageSpan = document.getElementById('burnPercentage');
            const burnProgressBar = document.getElementById('burnProgressBar');
            const burnSpeedSpan = document.getElementById('burnSpeed');
            
            totalChars = burningChars.length;
            let burnedChars = 0;
            currentCharIndex = 0;
            
            let burnDelay;
            if (totalChars < 100) {
                burnDelay = 150;
                burnSpeedSpan.textContent = "é€Ÿåº¦: æ…¢";
            } else if (totalChars < 500) {
                burnDelay = 120;
                burnSpeedSpan.textContent = "é€Ÿåº¦: ä¸­";
            } else {
                burnDelay = 100;
                burnSpeedSpan.textContent = "é€Ÿåº¦: å¿«";
            }
            
            showBurnNotification();
            
            createBurnCursor();
            
            burningInterval = setInterval(() => {
                if (currentCharIndex >= burningChars.length) {
                    clearInterval(burningInterval);
                    completeBurnAnimation();
                    return;
                }
                
                const charSpan = burningChars[currentCharIndex];
                if (charSpan) {
                    createFireTrail(charSpan);
                    
                    charSpan.classList.add('current-burning');
                    
                    setTimeout(() => {
                        charSpan.classList.add('char-burning');
                        
                        setTimeout(() => {
                            charSpan.classList.add('char-removed');
                            charSpan.classList.remove('current-burning');
                        }, 300);
                    }, 100);
                    
                    burnedChars++;
                    currentCharIndex++;
                    
                    const progress = Math.round((burnedChars / totalChars) * 100);
                    
                    charsBurnedSpan.textContent = burnedChars;
                    burnPercentageSpan.textContent = `${progress}%`;
                    burnProgressBar.style.width = `${progress}%`;
                    
                    updateBurnNotification(progress);
                    
                    updateBurnCursor();
                }
            }, burnDelay);
        }

        function createFireTrail(charSpan) {
            const rect = charSpan.getBoundingClientRect();
            
            const particleCount = Math.floor(Math.random() * 2) + 2;
            
            for (let i = 0; i < particleCount; i++) {
                const fire = document.createElement('div');
                fire.className = 'fire-trail';
                
                const offsetX = (Math.random() - 0.5) * 15;
                const offsetY = Math.random() * -15 - 5;
                
                fire.style.setProperty('--tx', `${offsetX}px`);
                fire.style.setProperty('--ty', `${offsetY}px`);
                
                fire.style.left = `${rect.left + rect.width / 2}px`;
                fire.style.top = `${rect.top + rect.height / 2}px`;
                
                document.body.appendChild(fire);
                
                setTimeout(() => {
                    if (fire.parentNode) {
                        fire.parentNode.removeChild(fire);
                    }
                }, 800);
            }
        }

        function createBurnCursor() {
            if (burnCursor) {
                burnCursor.remove();
            }
            
            burnCursor = document.createElement('div');
            burnCursor.className = 'burn-cursor';
            burnCursor.id = 'burnCursor';
            
            const contentDiv = document.getElementById('burningContent');
            contentDiv.appendChild(burnCursor);
            
            updateBurnCursor();
        }

        function updateBurnCursor() {
            if (!burnCursor || currentCharIndex >= burningChars.length) {
                if (burnCursor) {
                    burnCursor.style.display = 'none';
                }
                return;
            }
            
            const charSpan = burningChars[currentCharIndex];
            if (charSpan) {
                const rect = charSpan.getBoundingClientRect();
                const contentRect = document.getElementById('burningContent').getBoundingClientRect();
                
                burnCursor.style.left = `${rect.left - contentRect.left}px`;
                burnCursor.style.top = `${rect.top - contentRect.top}px`;
                burnCursor.style.height = `${rect.height}px`;
                burnCursor.style.display = 'block';
            }
        }

        function completeBurnAnimation() {
            if (burnCursor) {
                burnCursor.remove();
                burnCursor = null;
            }
            
            const burnNowBtn = document.getElementById('burnNowBtn');
            burnNowBtn.innerHTML = `<i class="fas fa-check"></i><span>å·²ç„šæ¯</span>`;
            burnNowBtn.classList.remove('text-orange-500', 'hover:text-red-500');
            burnNowBtn.classList.add('text-gray-500');
            
            setTimeout(() => {
                const contentDiv = document.getElementById('burningContent');
                contentDiv.innerHTML = `
                    <div class="text-center py-12 space-y-4">
                        <div class="text-4xl animate-pulse">ğŸ”¥</div>
                        <h3 class="text-xl font-bold text-red-500">å†…å®¹å·²ç„šæ¯</h3>
                        <p class="text-slate-400 text-sm">æ‰€æœ‰æ•°æ®å·²ä»æœåŠ¡å™¨æ°¸ä¹…åˆ é™¤</p>
                        <div class="text-xs text-slate-500 mt-4">
                            å­—ç¬¦é¡ºåºç„šæ¯å®Œæˆï¼Œå…±ç„šæ¯ ${totalChars} ä¸ªå­—ç¬¦
                        </div>
                    </div>
                `;
                
                document.querySelector('.pt-4.border-t').style.display = 'none';
            }, 500);
            
            try {
                fetch(`${API_URL}/api/share/delete/${shareId}`);
            } catch (e) {
                console.error('åˆ é™¤æœåŠ¡å™¨æ•°æ®å¤±è´¥:', e);
            }
            
            hideBurnNotification();
        }

        function showBurnNotification() {
            const existingNotification = document.getElementById('burnNotification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            const notification = document.createElement('div');
            notification.id = 'burnNotification';
            notification.className = 'burn-notification';
            notification.innerHTML = `
                <div class="text-white font-bold animate-pulse flex items-center gap-2">
                    <i class="fas fa-fire"></i>
                    <span>å­—ç¬¦é¡ºåºç„šæ¯ä¸­...</span>
                </div>
                <div class="text-xs text-white/80" id="burnNotificationProgress">0%</div>
            `;
            
            document.body.appendChild(notification);
            
            const autoHideTime = Math.min(15000, totalChars * 50 + 5000);
            setTimeout(() => {
                if (notification.parentNode && !isBurningActive) {
                    notification.remove();
                }
            }, autoHideTime);
        }

        function updateBurnNotification(progress) {
            const notification = document.getElementById('burnNotification');
            if (notification) {
                const progressSpan = document.getElementById('burnNotificationProgress');
                if (progressSpan) {
                    progressSpan.textContent = `${progress}%`;
                }
            }
        }

        function hideBurnNotification() {
            const notification = document.getElementById('burnNotification');
            if (notification && notification.parentNode) {
                setTimeout(() => {
                    if (notification.parentNode) {
                        notification.remove();
                    }
                }, 1000);
            }
        }

        function startBurnAnimation() {
            if (isBurningActive) return;
            
            const burnTimerDiv = document.getElementById('burnTimer');
            burnTimerDiv.classList.add('hidden');
            
            if (burnCountdownInterval) {
                clearInterval(burnCountdownInterval);
            }
            
            startSequentialBurnAnimation();
        }

        window.addEventListener('beforeunload', () => {
            if (burningInterval) {
                clearInterval(burningInterval);
            }
            if (burnCountdownInterval) {
                clearInterval(burnCountdownInterval);
            }
        });

        // ==================== å¿«é€Ÿè®¿é—®åŠŸèƒ½ ====================
        function scrollToTop() {
            window.scrollTo({ top: 0, behavior: 'smooth' });
        }

        // ==================== åˆå§‹åŒ– ====================
        if ('serviceWorker' in navigator) {
            navigator.serviceWorker.register('./sw.js')
                .then(() => console.log('Service Worker Registered'))
                .catch(err => console.error('Service Worker Registration Failed', err));
        }

        document.addEventListener('DOMContentLoaded', checkSession);
    </script>
</body>
</html>
